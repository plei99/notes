\documentclass[leqno, openany]{memoir}
\setulmarginsandblock{3.5cm}{3.5cm}{*}
\setlrmarginsandblock{3cm}{3.5cm}{*}
\checkandfixthelayout

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
%\usepackage{MnSymbol}
\usepackage{bm}
\usepackage{accents}
\usepackage{mathtools}
\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{automata,positioning}
\usepackage{tikz-cd}
\usepackage{forest}
\usepackage{braket} 
\usepackage{listings}
\usepackage{mdframed}
\usepackage{verbatim}
\usepackage{physics}
\usepackage{stackengine} 

%font
\usepackage[sc]{mathpazo}
\usepackage{eulervm}
\usepackage[scaled=0.86]{berasans} 
\usepackage{inconsolata}
\usepackage{microtype}

%CS packages
\usepackage{algorithmicx}
\usepackage{algpseudocode}
\usepackage{algorithm}

% typeset and bib
\usepackage[english]{babel} 
\usepackage[utf8]{inputenc} 
\usepackage[T1]{fontenc} 
\usepackage[backend=biber, style=alphabetic]{biblatex}
\usepackage[bookmarks, colorlinks, breaklinks]{hyperref} 
\hypersetup{linkcolor=black,citecolor=black,filecolor=black,urlcolor=black}

% other formatting packages
\usepackage{float}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{csquotes}
\usepackage{titlesec}
\usepackage{titling}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{parskip}

\usepackage{lipsum}

% delimiters
\DeclarePairedDelimiter{\gen}{\langle}{\rangle}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}


\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{quest}[thm]{Question}

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{defns}[thm]{Definitions}
\newtheorem{con}[thm]{Construction}
\newtheorem{exm}[thm]{Example}
\newtheorem{exms}[thm]{Examples}
\newtheorem{notn}[thm]{Notation}
\newtheorem{notns}[thm]{Notations}
\newtheorem{addm}[thm]{Addendum}
\newtheorem{exer}[thm]{Exercise}

\theoremstyle{remark}
\newtheorem{rmk}[thm]{Remark}
\newtheorem{rmks}[thm]{Remarks}
\newtheorem{warn}[thm]{Warning}
\newtheorem{sch}[thm]{Scholium}


% unnumbered theorems
\theoremstyle{plain}
\newtheorem*{thm*}{Theorem}
\newtheorem*{prop*}{Proposition}
\newtheorem*{lem*}{Lemma}
\newtheorem*{cor*}{Corollary}
\newtheorem*{conj*}{Conjecture}

% unnumbered definitions
\theoremstyle{definition}
\newtheorem*{defn*}{Definition}
\newtheorem*{exer*}{Exercise}
\newtheorem*{defns*}{Definitions}
\newtheorem*{con*}{Construction}
\newtheorem*{exm*}{Example}
\newtheorem*{exms*}{Examples}
\newtheorem*{notn*}{Notation}
\newtheorem*{notns*}{Notations}
\newtheorem*{addm*}{Addendum}


\theoremstyle{remark}
\newtheorem*{rmk*}{Remark}

% shortcuts
\newcommand{\Ima}{\mathrm{Im}}
\newcommand{\A}{\mathbb{A}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\renewcommand{\k}{\Bbbk}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\M}{\overline{M}}
\newcommand{\g}{\mathfrak{g}}
\newcommand{\h}{\mathfrak{h}}
\newcommand{\n}{\mathfrak{n}}
\renewcommand{\b}{\mathfrak{b}}
\newcommand{\ep}{\varepsilon}
\newcommand*{\dt}[1]{%
   \accentset{\mbox{\Huge\bfseries .}}{#1}}
\renewcommand{\abstractname}{Official Description}
\newcommand{\mc}[1]{\mathcal{#1}}
\newcommand{\T}{\mathbb{T}}
\newcommand{\mf}[1]{\mathfrak{#1}}
\newcommand{\mr}[1]{\mathrm{#1}}
\newcommand{\ms}[1]{\mathsf{#1}}
\newcommand{\ol}[1]{\overline{#1}}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\wt}[1]{\widetilde{#1}}
\newcommand{\wh}[1]{\widehat{#1}}
\newcommand{\pt}{\mathrm{pt}}
\renewcommand{\op}{\mathrm{op}}

\DeclareMathOperator{\Der}{Der}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\ad}{ad}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Rad}{Rad}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Supp}{Supp}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\rk}{rk}
\DeclareMathOperator{\spec}{Spec}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Proj}{Proj}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Ass}{Ass}
\DeclareMathOperator{\dpth}{depth}
\DeclareMathOperator{\pdim}{proj.dim}
\DeclareMathOperator{\idim}{inj.dim}
\DeclareMathOperator{\gdim}{gl.dim}
\DeclareMathOperator{\Pic}{Pic}
\DeclareMathOperator{\NS}{NS}
\DeclareMathOperator{\codim}{codim}
\DeclareMathOperator{\Bl}{Bl}

% Section formatting
\titleformat{\section}
    {\Large\sffamily\scshape\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}[runin]
    {\large\sffamily\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}[runin]{\normalfont\itshape}{\thesubsubsection}{1em}{}

\title{COURSE TITLE}
\author{Lectures by INSTRUCTOR, Notes by NOTETAKER}
\date{SEMESTER}

\newcommand*{\titleSW}
    {\begingroup% Story of Writing
    \raggedleft
    \vspace*{\baselineskip}
    {\Huge\itshape Moduli Spaces and Hyperk\"ahler Manifolds  \\ Fall 2021}\\[\baselineskip]
    {\large\itshape Notes by Patrick Lei}\\[0.2\textheight]
    {\Large Lectures by Giulia Sacc\`a}\par
    \vfill
    {\Large \sffamily Columbia University}
    \vspace*{\baselineskip}
\endgroup}
\pagestyle{simple}

\chapterstyle{ell}


%\renewcommand{\cftchapterpagefont}{}
\renewcommand\cftchapterfont{\sffamily}
\renewcommand\cftsectionfont{\scshape}
\renewcommand*{\cftchapterleader}{}
\renewcommand*{\cftsectionleader}{}
\renewcommand*{\cftsubsectionleader}{}
\renewcommand*{\cftchapterformatpnum}[1]{~\textbullet~#1}
\renewcommand*{\cftsectionformatpnum}[1]{~\textbullet~#1}
\renewcommand*{\cftsubsectionformatpnum}[1]{~\textbullet~#1}
\renewcommand{\cftchapterafterpnum}{\cftparfillskip}
\renewcommand{\cftsectionafterpnum}{\cftparfillskip}
\renewcommand{\cftsubsectionafterpnum}{\cftparfillskip}
\setrmarg{3.55em plus 1fil}
\setsecnumdepth{subsection}
\maxsecnumdepth{subsection}
\settocdepth{subsection}

\begin{document}
    
\begin{titlingpage}
\titleSW
\end{titlingpage}

\thispagestyle{empty}
\section*{Disclaimer}%
\label{sec:disclaimer}

Unless otherwise noted, these notes were taken during lecture using the
\texttt{vimtex} package of the editor \texttt{neovim}.  Any errors are mine and
not the instructor's.  In addition, my notes are picture-free (but will include
commutative diagrams) and are a mix of my mathematical style and that of the
instructor.  If you find any errors, please contact me at
\texttt{plei@math.columbia.edu}.

\subsection*{Acknowledgements}%
\label{sub:acknowledements}

I would like to acknowledge Kevin Chang, Kuan-Wen Chen, Che Shen, and Nicol\'as Vilches for pointing out mistakes in these notes.


\newpage

\tableofcontents

\chapter{Hyperk\"ahler Manifolds}%
\label{cha:introduction}

Some useful references for K3 surfaces are the book by Huybrechts and the Barth-Peters-van de Ven book \textit{Compact Complex Surfaces} and another book. For Hilbert schemes some references are Chapter 7 of \textit{FGA Explained}, Huybrechts-Lehn, some lectures of notes of Lehn, and Nakajima's \textit{Lectures on Hilbert Schemes}. For Hilbert schemes of K3 surfaces and abelian varieties, there is Beauville's \textit{Variet\'es Kahlerienne dont la premiere classe de Chern est nulle}. 

\section{Motivation}%
\label{sec:motivation}

Giulia believes that hyperk\"ahler manifolds are some of the most interesting objects in algebraic geometry because one can actually prove results about high-dimensional hyperk\"ahler varieties, unlike the usual situation in algebraic geometry. Because these objects are of a differential-geometric nature, through the course we will work over $\C$.

Recall that in order to classify curves, for a given curve $C$, we want to consider the positivity of the canonical bundle. In the first case, we know $\omega_{\P^1} = \mc{O}(-2) < 0$, in the second case of an elliptic curve, we have $\omega_C = \mc{O}_C$, and finally for a higher genus curve the canonical sheaf $\omega_C > 0$ is ample.

In higher dimension, let $X$ be a smooth projective variety. Then there exists an integer $\kappa(X)$, the \textit{Kodaira dimension} of $X$ such that
\[ h^0(\omega_X^{\otimes m}) \sim m^{\kappa(X)} \]
for $m \gg 0$ sufficiently divisible. Of course, this is a birational invariant.

There is a classification of surfaces. Each smooth surface is birational to a \textit{minimal} surface. Here, a surface $S$ is minimal if any birational morphism from $S$ to a smooth surface is a birational curve. By Castelnuovo, we know that $S$ is minimal if and only if it does not contain a $(-1)$-curve. Also, any surface dominates a minimal surface.

\section{Hyperk\"ahler manifolds}%
\label{sec:hyperkahler_manifolds}

\begin{exm}
    If $S$ is a surface, then $\kappa(S) = -\infty$ if and only if 
    \[ P_m(S) \coloneqq h^0(\omega_S^{\otimes m}) = 0 \] 
    for all $m \geq 1$. Some examples of these are $\P^2$ and $\P^1 \times \P^1$.
\end{exm}

\begin{exm}
    If $S$ is a surface, then $\kappa(S) = 0$ if and only if $P_m(S) = 0$ generically and there exists $m$ such that $P_m(S) = 1$. In this case, there are two cases. First, $h^0(\omega_S) = 1$, in which case $\omega_S = \mc{O}_S$, and thus either $h^1(\mc{O}_S) = 0$ (in which case we have a \textit{K3 surface}) or $\h^1(\mc{O}_S) = 2$ (in which case we have an \textit{abelian surface}).

    Alternatively, we may have $h^0(\omega_S) = 0$, in which case there exists $m \geq 2$ (where $m \in \qty{2,3,4,6}$) such that $\omega_S^{\otimes m} = \mc{O}_S$. Either $h^1(\mc{O}_S) = 0$, in which case we have an Enriques surface, or $h^1(\mc{O}_S) = 1$, in which case we have a bi-elliptic surface.

    If $T$ is an Enriques surface, then there exists a K3 surface $S$ with a $2:1$ \'etale cover $S \to T$. On the other hand, any bi-elliptic surface has an $m:1$ \'etale cover from an abelian surface.
\end{exm}

\begin{thm}[Beauville-Bogomolov]
    Let $M$ be a compact K\"ahler manifold with $c_1(\omega_M) = 0$. The there exists a finite \'etale cover of $M$ by a product
    \[ T^n \times \prod Y_i \times \prod X_i \to M, \]
    where $T^n$ is a complex torus, the $Y_i$ are \textit{strict Calabi-Yau}, and the $X_i$ are \textit{irreducible holomorphic symplectic} (or hyperk\"ahler).  
\end{thm}

\begin{defn}
    Let $Y$ be a compact K\"ahler manifold. Then $Y$ is \textit{strict Calabi-Yau} if $\pi_1(Y) = 1$ and $H^0(\Omega^P_Y) = \C$ when $p = 0, \dim Y$ and $H^0(\Omega^P_Y)$ vanishes elsewhere.
\end{defn}

\begin{defn}
    A compact K\"ahler manifold $X$ is \textit{irreducible holomorphic symplectic} if $\pi_1(X) = 1$ and $H^0(\Omega^2_X) = \C \sigma_X$, where $\sigma_X$ is an irreducible symplectic form. In particular, $\sigma^n$ is a nonzero top form and thus trivializes the canonical bundle. In addition, $\sigma$ induces an isomorphism of holomorphic vector bundles $\Omega_X \simeq T_X$.
\end{defn}

\section{Some surfaces}%
\label{sec:some_surfaces}

Returning to the simplest case, we will define K3 surfaces.
\begin{defn}
    A smooth projective surface $S$ is a \textit{K3 surface} if $\omega_S = 0$ and $h^1(\mc{O}_S) = 0$. 
\end{defn}
It follows from the definition that K3 surfaces are simply connected, so they are in fact both strict Calabi-Yau and irreducible holomorphic symplectic. Later in the course, we will see that irreducible holomorphic symplectic varieties are the true higher-dimensional analogues of K3 surfaces.

\begin{lem}
    Let $S$ be a K3 surface and $f \colon S \to C$ be a dominant morphism to a smooth projective curve $C$ with connected fibers. Then $C = \P^1$ and the general fiber of $f$ is an elliptic curve.
\end{lem}

\begin{proof}
    The proof is left as an exercise to the reader.
\end{proof}

Any K3 surface $S$ with a dominant map to a curve is called an \textit{elliptic K3}. As a consequence, any surjective map $f \colon S \to B$ where $B$ is not a point and $f$ has connected fibers has either $B = \P^1$ or $B$ is a singular K3. This is generalized by the following remarkable result:

\begin{thm}[Matsushita]
    Let $X^{2n}$ be an irreducible holomorphic symplectic manifold and $f \colon X \to B$ be a proper surjective morphism with connected fibers with $B$ a normal variety. If $B$ is not a point, then either $\dim B = n$ and $f$ is a Lagrangian fibration where the general fiber is an abelian $n$-fold or $\dim B = 2n$ and $B$ is a singular symplectic variety if $f$ is not an isomorphism. In the second case, $f$ is called a symplectic resolution.
\end{thm}

\begin{rmk}
    There is another extremely difficult result of Hwang, which says that if $B$ is smooth, then $B = \P^n$ (if $\dim B = 3$, apparently $B$ is a $\Q$-factorial Fano threefold with klt singularities).
\end{rmk}

Now we will consider some examples. Beginning in the simplest case, consider a general section $f_4 \in \abs{\mc{O}_{\P^3}(4)}$. By the Bertini theorem, the general $S = (f_4 = 0)$ is smooth, and by the adjunction formula, $\omega_S = \mc{O}_S$. Then we consider the exact sequence
\[ 0 \to \mc{O}_{\P^3}(4) \to \mc{O}_{\P^3} \to \mc{O}_S \to 0, \]
and by the long exact sequence of cohomology and the known values of cohomology for projective space, we have $H^1(\mc{O}_S) = 0$. 

\begin{exm}
    A concrete example of this is the Fermat quartic, which has the equation
    \[ x_0^4 + x_1^4 + x_2^4 + x_3^4 = 0. \]
    We will see that this is an elliptic K3. The first step is to see that $S$ contains a line $\ell \subseteq S \subseteq \P^3$, so we choose a primitive $\zeta_8$ and set $x_0 = \zeta_8 x_1$ and $x_2 = \zeta_8 x_3$. Now we project $S$ from $\ell$, and considering planes that contain $\ell$, we obtain a rational map $S \dashrightarrow \P^1$. This extends over $\ell$. Finally, we know that $S \cap \P^2$ is a quartic curve containing a line $\ell$, so in fact the generic fiber of this map is an elliptic curve.
\end{exm}

Similarly, we may consider other complete intersections, such as the $(2,3)$ complete intersection in $\P^4$ (intersection of a quadric and a cubic) and the $(2,2,2)$ complete intersection in $\P^5$. In higher dimensions, any degree $(n+1)$ hypersurface $Y$ in $\P^n$ has $\omega_Y = \mc{O}_Y$. By the Lefschetz hyperplane theorem, this is a strict Calabi-Yau. 

\begin{exm}
    Let $\Gamma \in \abs{\mc{O}_{\P^2}(6)}$ be a general sextic and $S$ be a $2:1$ cover of $\P^2$ branched along $\Gamma$. We will use the \textit{covering trick}, which holds for any variety $X$, line bundle $L$, and $0 \neq s \in H^0(L^{\otimes m})$ for some $m \geq 1$. Then if we set $D = (s = 0)$, there exists a finite flat morphism $f \colon Y \to X$ that is a $\Z/m$-cover away from $D$ and ramified along $D$. In this case, $f^* L$ has a section $t$ such that $(t=0) \simeq D$. Finally if $X$ and $D$ are smooth, so is $Y$, and $\omega_Y = f^* \omega_X((m-1) (t=0))$. 

    In our example, we have $\omega_S = f^* \omega_{\P^2} \otimes \mc{O}_X(y^2=\Gamma) = \mc{O}_S$, so $S$ is a K3 surface.
\end{exm}

\begin{exm}[Kummer K3 surfaces]
    Let $A$ be an abelian surface. It has an involution $-1$ with fixed locus $A[2]$. Thus $A/\pm 1$ has $16$ singular points that look like $\C^2/\pm 1 = \Spec \C[x^2, xy, y^2] = \Spec \C[a,b,c]/(ab=c^2)$ (the $A_1$ singularity). Now the surface $S = \mr{Bl}_{A[2]} A/\pm 1$ is a K3 surface.

    It is easy to see that the smooth locus of $A/\pm 1$ has a holomorphic symplectic form $\sigma_{A/\pm 1}$. Then we can bull back $f^* \sigma_{A/\pm 1}$ to a holomorphic symplectic form on $f^{-1}(U) \subseteq S$, and this form extends to $S$. The reason for this is that $\Bl_{A[2]} A$ still has the involution $-1$, and $S$ is the quotient of $\Bl_{A[2]} A$ by this involution. If we denote this diagram by
    \begin{equation}
    \begin{tikzcd}
        \Bl_{A[2]} A \arrow{r}{q} \ar{d}{g} & S \ar{d}{f} \\
        A \arrow{r}{p} & A/\pm 1
    \end{tikzcd}
    \end{equation}
    and denote $\wt{A} \coloneqq \Bl_{A[2]} A$, then we obtain
    \begin{align*} 
        \omega_{\wt{A}} &= f^* \omega_A \otimes \mc{O}\qty(\sum E_i) = \mc{O}_{\wt{A}}\qty(\sum E_i) \\
                        &= q^* \omega_S \otimes \mc{O}_{\wt{A}}\qty(\sum E_i) 
    \end{align*}
    and therefore $q^* \omega_S = \mc{O}_{\wt{A}}$, so $\omega_S = \mc{O}_S$. The morphism $f$ is called a \textit{symplectic resolution}. 
\end{exm}

Before we proceed, we will discuss crepant and symplectic resolutions. Let $Y$ be a smooth variety, so $\Omega^1_Y$ is locally free. Then $\omega_Y \coloneqq \bigwedge^{\dim Y} \Omega^1_Y$ is called the \textit{canonical bundle}. Then if $f \colon X \to Y$ is a birational morphism of smooth varieties, we have an exact sequence
\[ 0 \to f^* \Omega^1_Y \to \Omega^1_X \to \Omega^1_{X/Y} \to 0. \]
Then we know $\Omega^1_{X/Y}$ is supported on the exceptional locus of $f$. Because $Y$ is smooth, then the exceptional locus is divisorial, and thus 
\[\omega_X = f^* \omega_Y \otimes \mc{O}_X\qty(\sum a_i E_i). \]
Now suppose that $Y$ is just normal with smooth locus $U$. Also suppose that $Y \setminus U$ has codimension at least $2$, so Weil divisors on $U$ and $Y$ are the same. There are two ways to extend $\omega_U$ to $Y$. The first is to denote the inclusion $j \colon U \subseteq Y$ and consider the sheaf $j_* \omega_U$, which is generally not locally free. On the other hand, we can extend the Weil divisor $K_U$ to $Y$, which determines a Weil divisor $K_Y$ on $Y$, called the \textit{canonical class}.

\begin{rmk}
    In general, the Weil divisor $K_Y$ is not Cartier. In fact, $K_Y$ is Cartier if and only if $j_* \omega_U$ is locally free.
\end{rmk}

Now let $f \colon X \to Y$ be a reolution of $Y$. This means $f$ is proper and an isomorphism over $U$. We want a formula relating of the form $K_X = f^* K_Y + \sum a_i E_i$. Unfortunately, we can only pull back Cartier divisors, so we will assume that $K_Y$ is $\Q$-Cartier, which means that there exists $m \geq 1$ such that $mK_Y$ is Cartier. We know that $f^{-1}(U) \simeq U$, so $\eval{K_X}_{f^{-1}(U)} = \eval{f^* K_Y}_{f^{-1}(U)}$. Thus there exist integers $a_i$ such that
\[ m K_X = f^* m K_Y + \sum a_i E_i, \]
where the $E_i$ are the divisorial components of $X \setminus f^{-1}(U)$. Formally dividing by $m$, we have
\[ K_X = f^* K_Y + \sum a_i E_i. \]
Here, the $a_i$ are known as the \textit{discrepancies} and if $a_i = 0$, then the resolution is called \textit{crepant}.

\begin{exm}
    One example of a crepant resolution is $S \to A / \pm 1$.
\end{exm}

\begin{exm}
    Consider $Y = \C^{2N}/\pm 1$. This is the cone over the degree $2$ Veronese embedding of $\P^{2N-1}$. Now we will write $f \colon X = \Bl_0 Y \to Y$, and the exceptional divisor is a $\P^{2N-1}$. We know that $X$ is the total space of $\mc{O}(-2)$, so there is a projection $X \to \P^{2N-1}$. Now we need to compute $a$ in the formula
    \[ K_X = f^* K_Y + aE. \]
    First note that $K_Y = 0$. This is because the standard holomorphic symplectic form on $\C^{2N}$ descends to the smooth locus $U \subseteq Y$, so we have a symplectic form on $X \setminus E$. Now by the adjunction formula, we have
    \[ K_E = \eval{(K_X+E)}_E, \]
    and thus because $E = \P^{2N-1}$, we have
    \[ \mc{O}_E(-2N) = \eval{(a+1)E}_E. \]
    Finally, we see that $\eval{\mc{O}_X(E)}_E = \mc{O}_{\P^{2N-1}}(-2)$, and thus $a+1 = N$, so $a = N-1$. In particular, $f$ is a crepant resolution if and only if $N = 1$. For $N \geq 2$, $f^* \omega_U$ extends to $X$ with a zero of order $N-1$ along $E$. Therefore the form
    \[ f^* \sigma_U \wedge \cdots \wedge f^* \sigma_U \]
    has a zero of order $N-1$ along $E$, so $f^* \sigma_U$ does not extend over $E$.\footnote{In fact, in this case, no crepant resolution exists. A necessary condition for $f$ to be a symplectic resolution is that it is crepant. In dimension $2$, the two notions are the same.}
\end{exm}

\section{Hilbert Schemes of points on surfaces}%
\label{sec:hilbert_schemes_of_points_on_surfaces}

Let $X$ be a smooth quasiprojective surface. Consider the functor
\[ \mr{Hilb}_X^n \colon \ms{Sch}^{\mr{op}} \to \ms{Set} \]
associating a scheme $T$ to isomorphism classes of flat proper morphisms $T \times X \supseteq Z \to T$ satisfying $p_{Z_t}(t) = n$.

\begin{thm}[Grothendieck]
    The functor $\mr{Hilb}_X^n$ is representable by a quasiprojective scheme $X^{[n]}$. If $X$ is projective, so is $X^{[n]}$.
\end{thm}

Later in the course, we will sketch a construction of the Hilbert scheme, but for now we will simply assume that it exists. A fundamental resolt about Hilbert schemes is
\begin{thm}[Fogarty]
    Let $X$ be a smooth quasiprojective surface. Then $X^{[n]}$ is a smooth connected quasiprojective variety of dimension $2n$ and there exists a morphism $h \colon X^{[n]} \to X^{(n)}$, called the \textit{Hilbert-Chow morphism},\footnote{This may be the most studied morphism in algebraic geometry besides $\P^n \to \Spec k$.} which is a resolution of singularities. Here, if $Z$ is a length $n$ subscheme of $Z$, we have
    \[ h(Z) = \sum_{p \in X} \ell(\mc{O}_{Z,p}) \cdot p. \]
\end{thm}

\begin{exm}
    For $n = 2$, we are looking for ideal sheaves $I \subseteq \mc{O}_X$ with quotient $\mc{O}_Z$ of length $2$. At a point $p$, we know $I/ \mf{m}^2 \subseteq \mf{m}/\mf{m}^2$, and thus subschemes of length $2$ supported on $p$ form a $\P \mf{m}/\mf{m}^2 = \P^1$.
\end{exm}

\begin{proof}[Sketch of smoothness]
    We need to compute the Zariski tangent space at a given point, so we have
    \[ T_{[Z]} X^{[n]} = \Hom_{0 \mapsto Z}(\Spec \C[\ep], X^{[n]}). \]
    By definition, these are flat proper families of length $n$ subschemes $\mc{Z} \to \Spec \C[\ep]$ such that $\eval{\mc{Z}}_{\ep = 0} = Z$, and by a computation (for example in FGA Explained) we have
    \[ T_{[Z]} = \Hom_X(I_Z, \mc{O}_Z). \]
    To compute the dimension, we begin by considering the exact sequence
    \[ 0 \to I_Z \subseteq \mc{O}_X \to \mc{O}_Z \to 0 \]
    and applying the functor $\Hom_X(-, \mc{O}_Z)$, we have an exact sequence
    \[ 0 \to \Hom_X(\mc{O}_Z, \mc{O}_Z) \to \Hom_X(\mc{O}_X, \mc{O}_Z) \to \Hom_X(I_Z, \mc{O}_Z) \to \Ext_X^1(\mc{O}_Z, \mc{O}_Z) \to \Ext_X^1(\mc{O}_Z, \mc{O}_Z), \]
    and thus because $\Hom_X(\mc{O}_X, \mc{O}_Z) \to \Hom_X(I_Z, \mc{O}_Z)$ is the zero morphism, and $\Ext_X^1(\mc{O}_Z, \mc{O}_Z) = H^1(\mc{O}_Z) = 0$, we can simply compute the Ext group. Here, we have
    \[ \chi(\mc{O}_Z, \mc{O}_Z) \coloneqq \sum_{i=0}^2 {(-1)}^i \dim \Ext^i (\mc{O}_Z, \mc{O}_Z). \]
    We simply need to show that the Euler characteristic vanishes because
    \[ \Ext^2(\mc{O}_Z, \mc{O}_Z) = {\Hom(\mc{O}_Z, \omega_X \otimes \mc{O}_Z)}^{\vee} \]
    has dimension $n$, as does $\Hom(\mc{O}_Z, \mc{O}_Z)$. To do this, we use Grothendieck-Riemann-Roch, which says that
    \[ \chi(\mc{F}, \mc{G}) = \mr{ch}(\mc{F}^{\vee}) \cdot \mr{ch}(\mc{G}) \sqrt{\mr{td}(X)}, \]
    and here we see that $\chi(\mc{O}_X, \mc{G}) = \chi(\mc{F})$ where $\mc{F} = \wt{O}_X$. Now because $\supp (\mc{F})$ has dimension $0$, then $\mr{ch}(\mc{F}) = [0, \ldots, \pm \ell (\mc{F})]$.
\end{proof}

\begin{exer}
    Prove that $\chi(\mc{O}_Z, \mc{O}_Z) = 0$ using a locally free resolution in the first variable.
\end{exer}

Now we will review some basic theory of Hilbert schemes for quasiprojective varieties. Here, if $X$ is quasiprojective and $p(t) \in \Q[t]$ is some Hilbert polynomial, consider $[Z] \in \mr{Hilb}_X^{p(t)}$.

\begin{prop}
    If $I \subseteq \mc{O}_X$ is the ideal sheaf of $Z$, then $T_{[Z]} \mr{Hilb} = \Hom_X(I, \mc{O}_Z) = \Hom_Z(I/I^2, \mc{O}_Z) = H^0(Z, N_{Z/X})$.
\end{prop}

\begin{proof}[Sketch of proof]
    We know that $T_{[Z]} \mr{Hilb} = \Hom(\Spec k[\ep], \mr{Hilb}, 0 \mapsto [Z])$. This set of morphisms is the same as the set of $\mc{Z} \subseteq X \times \Spec k[\ep]$ flat over $k[\ep]$. And a module $M$ is flat over $k[\ep]$ if and only if $M \otimes (\ep) \simeq \ep \cdot M$. Now we want an ideal sheaf $\wt{I} \subseteq \mc{O}_X[\ep]$ such that
    \begin{equation*}
    \begin{tikzcd}
        & 0 & 0 & 0 \\
        0 \ar{r} & I \ar{r} \ar{u} & \mc{O}_X \ar{u} \ar{r} & \mc{O}_Z \ar{r} \ar{u} & 0 \\
        0 \ar{r} & \wt{I} \ar{u} \ar[hookrightarrow]{r} & \mc{O}_X[\ep] \ar{r} \ar{u} & \mc{O}_{\wt{\mc{Z}}} \ar{r} \ar{u} & 0 \\
        0 \ar{r} & I \ar{r} \ar[hookrightarrow]{u}{\cdot \ep} & \mc{O}_X \ar{u}{\cdot \ep} \ar{r} & \mc{O}_Z \ar{r} \ar{u} & 0 \\
        & & 0 \ar{u} & 0 \ar{u}
    \end{tikzcd}
    \end{equation*}
    But now we can see that $I = \wt{I}/\ep I \subseteq \mc{O}_X \oplus \ep \mc{O}_Z$, and thus giving $\wt{I}$ is the same as giving an element of $\Hom_X(I, \mc{O}_Z)$.
\end{proof}

\begin{exer}
    Let $X$ be a smooth quasiprojective curve. Show that $X^{[n]} = X^{(n)}$ is smooth of dimension $n$.\footnote{Newton actually proved way back in the day that the symmetric powers of $\A^1$ are smooth (and equal to $\A^n$).}
\end{exer}

\begin{thm}
    Let $X$ be a quasiprojective variety. Then there exists a regular proper morphism 
    \[ h_n \colon X^{[n]} \to X^{(n)} \qquad Z \mapsto \sum_{p \in X} \ell(\mc{O}_Z, p) p \]
    which is surjective and birational. By a result of Fogarty, the fibers of $h_n$ are connected, so if $X$ is connected, so is $X^{[n]}$.
\end{thm}


From now on, we will assume that $X$ is projective. Therefore, for all $Z \subseteq X$ with $\ell(Z) = n$, there exists an open affine neighborhood $U \subseteq X$ containing $Z$. Therefore we have $[Z] \in U^{(n)} \subseteq X^{(n)}$. Now if $Z = \sum \alpha_i p_i$ and $U_i \ni p_i$ are open neighborhoods, then $Z \in \prod U_i^{(\alpha_i)}$.

\begin{rmk}
    If $X$ is a smooth surface, then the local structure of $X^{(n)}$ at $np$ is the same as the local structure of ${(\A^n)}^{(n)}$ at $n \cdot \qty{0}$. In particular, when $n = 2$, we have
    \[ (X^{(2)}, 2p) \simeq (Q, 0) \times \Delta, \]
    where $\Delta$ is smooth of dimension $2$ and $Q$ is the quadric cone.
\end{rmk}

Now for any partition $n = \sum \alpha_i$ of $n$ into positive integers with length $k$, write $\ul{\alpha} = (\alpha_i)$. Then define
\[ X_{\alpha}^{(n)} = \qty{ \sum \alpha_i z_i \mid z_i \neq z_j }. \]
These $X_{\alpha}^{(n)}$ give a stratification of $X^{(n)}$ into locally closed subsets, where the open stratum is $X^{(n)}_{(1,1,\ldots,1)}$ and the closed stratum is $X^{(n)}_{(n)}$. It is easy to see that $\dim X_{\ul{\alpha}}^{(n)} = 2 \ell(\alpha)$. Another important stratum is $X_{(2,1,\ldots,1)}^{(n)}$, where exactly two points come together. Now note that 
\[ h_n^{-1}(\sum \alpha_i z_i) = \prod h_{\alpha_i}^{-1} (\alpha_i z_i), \]
where the $h_{\alpha_i}^{-1}$ are the \textit{punctual Hilbert schemes} $\mr{Hilb}^{\alpha_i}(\mc{O}_X, z_i) \simeq \mr{Hilb}^{\alpha_i} ( k[x_1, x_2], 0 )$. For $\alpha = 2$, the punctual Hilbert scheme is simply $\P \mf{m}/\mf{m}^2$.\footnote{Apparently these are useful in representation theory.}

\begin{thm}[Brian\c{c}on]
    The fiber $h_n^{-1}(nz)$ is irreducible of dimension at most $n-1$.
\end{thm}

In particular, this tells us that $X^{[n]}_{(1,\ldots,1)} \to X^{(n)}_{(1,\ldots,1)}$ has fibers of dimension $0$ and is thus an isomorphism.

\begin{prop}
    The exceptional locus of $h_n$ is an irreducible divisor $E$.
\end{prop}

\begin{proof}
    Because $X^{(n)}$ is normal and $\Q$-factorial,\footnote{Every finite quotient of something smooth is $\Q$-factorial.} then any birational $Y \to X^{(n)}$ from a smooth variety $Y$ has divisorial exceptional divisor.

    Now the exceptional locus $E_{(2,1,\ldots,1)} to X^{(n)}_{(2,1,\ldots,1)}$ has fibers $\P^1$, while for a general $\ul{\alpha}$, we have
    \[ \dim E_{\ul{\alpha}} = \dim X_{\ul{\alpha}}^{(n)} + \sum \dim h_{\alpha_i}^{-1} (\alpha_i z_i) \leq n + \ell(\ul{\alpha}). \]
    Because the strata are irreducible and so are the fibers, we obtain irreducibility for the exceptional divisor.
\end{proof}

\begin{prop}
    Let $X$ be a projective variety. Then there exists a birational surjective morphism $h \colon X^{[n]} \to X^{(n)}$.
\end{prop}

\begin{proof}
    We will show that for all $Z \subseteq T \times X$ proper and flat over $T$ with $\ell(Z_t) = n$ for all $t$, there exists a natural morphism $T \to X^{(n)}$ given by
    \[ t \mapsto \sum_{p \in X} \ell(\mc{O}_{Z_t}, p) \cdot p. \]
    Fix $t_0 \in T$. Because $X$ is projective, there exists $U \subseteq X$ affine with $Z_{t_0} \in U = \Spec A$. Then because $p \colon Z \to T$ is proper, there exists $t_0 \in V \subseteq T$, where $V = \Spec B$ is affine, and for all $t \in V$, $Z_t \in U$. In conclusion, we have a family $Z_V \subseteq V \times U$. At the level of rings, we have a diagram
    \begin{equation*}
    \begin{tikzcd}
        C & B \otimes A \ar[twoheadrightarrow]{l}{\varphi} \\
        B \ar{u}.
    \end{tikzcd}
    \end{equation*}
    Now we need a map ${(A^{\otimes n})}^{S_n} \to B$. Because $Z \to V$ is flat, $C$ is a rank $n$ projective $B$-module. Clearly we have a map $A \to \End_B(C)$ given by $A \mapsto \varphi(1 \otimes a)$, and thus $A^{\otimes n}$ acts on $C^{\otimes n}$. Then we obtain an action of ${(A^{\otimes n})}^{S_n}$ on $\bigwedge^n C$, which is just a map
    \[ {(A^{\otimes n})}^{S_n} \to \End_B\qty({\bigwedge}^n C) \simeq B, \]
    which is the map we want.
\end{proof}

As an example, consider $B = k$. Then $C = \prod C_i$ is Artinian, hence a product of Artinian local rings $C_i$ of length $\alpha_i$. Then the map we defined at the end of the proof factors through $\prod \mr{Sym}^{\alpha_i}(C_i)$.

\begin{thm}[Beauville-Fujiki]
    Let $X$ be a smooth surface. Then the Hilbert-Chow morphism is a crepant resolution and if $X$ has a holomorphic symplectic form, so does $X^{[n]}$.
\end{thm}

\begin{exer}
    If $X$ is a smooth surface, prove that
    \[ X^{[n]} = \Bl_{\Delta} X^{(2)} = (\Bl_{\Delta} X \times X) / S_2. \]
\end{exer}

\begin{proof}
    Consider $X_*^{(n)} = X^{(n)}_{(1,\ldots,1)} \cup X^{(n)}_{(2,1,\ldots,1)}$ and define $X^n_*, X^{[n]}_*$ similarly. In $X^n$ consider $\Delta = \bigcup \Delta_{ij}$, where the $i$-th and $j$-th points coincide. Now consider the diagram
    \begin{equation*}
    \begin{tikzcd}
        \Bl_{\Delta} X_*^n \ar{r}{\eta} \ar{d}{\rho} & X_*^n \ar{d} \\
        X_*^{[n]} \ar{r}{h} & X_*^{(n)},
    \end{tikzcd}
    \end{equation*}
    which quite clearly commutes by the same argument showing that $X^{[n]}$ is the blowup of $X^{(n)}$ along the diagonal. Then the exceptional divisor $\bigcup E_{ij}$ is fixed by $S_2$, so it maps to $E_* \subset X_*^{[n]}$. Now it suffices to prove that $X_*^{[n]} \to X_*^{(n)}$ is crepant because the complement has codimension $2$. To see this, the quotients by $S_n$ have simple ramification, and thus we have
    \begin{align*} 
        K_{\Bl_{\Delta} X_*^n} &= \rho^*(K_{X_*^{[n]}}) + \sum E_{ij} \\
        &= \rho^* h^* K_{X_*^{(n)}} + (a+1) \sum E_{ij} \\
        &= \eta^* K_{X_*^n} + \sum E_{ij},
    \end{align*}
    so $a = 0$ because $\pi \colon X_*^n \to X_*^{(n)}$ is \'etale away from codimension $2$ and thus $K_{X^n_*} = \pi^* K_{X_*^{(n)}}$. Therefore the Hilbert-Chow morphism is a crepant resolution.

    Now suppose that $X$ has a holomorphic symplectic form $\omega_X \in H^0(\Omega^2_X)$. By codimension reasons, it is enough to produce a holomorphic symplectic form on $X_*^{[n]}$. Clearly we have a symplectic form $\omega \coloneqq \sum_i p_i^* (\omega_X)$ on $X_*^n$, which is clearly $S_n$-invariant. Therefore, we obtain a symplectic form $\sigma_{X^{(n)}_{(1,\ldots,1)}}$ on $X^{(n)}_{(1,\ldots,1)}$ and a symplectic form $\eta^* \omega$ on $\Bl_{\Delta} X_*^n$, which is degenerate along $\bigcup E_{ij}$ and $S_n$-invariant. This induces a holomorphic $2$-form $\sigma_{X_*^{[n]}}$ on $X_*^{[n]}$ (as in there exists such a $\sigma$ such that $\eta^* \omega = \rho^* \sigma$). We know that $\sigma_{X_*^{[n]}}$ is generically nondegenerate.

    We now show that $\sigma \coloneqq \sigma_{X_*^{[n]}}$ is symplectic. We know $\sigma^n$ is a section of $\omega_{X_*^{[n]}}$, so the degeneracy locus of $\sigma$ is the zero locus of $\sigma^n$. However, we know $K_{X_*^{(n)}} = 0$ by the existence of $\omega_X$, and because $h$ is crepant, we see that $K_{X_*^[n]} = 0$, and thus $\sigma^n$ must be nonzero everywhere.
\end{proof}

We will now discuss some invariants of $X^{[n]}$.

\begin{prop}
    There is an isomorphicm of Hodge structures
    \[ H^2(X^{[n]}, \Q) = h^* H^2(X^{(n)}) \oplus \Q E.\footnote{Note that $X^{(n)}$ is a finite quotient of something smooth and thus has a pure Hodge structure.} \]
\end{prop}

Now we know that $H^2(X^{(n)}) = {H^2(X^n)}^{S_n}$. By the K\"unneth formula, we have
\[ H^2(X^n) = \bigoplus_{i=1}^n H^2(X) \otimes H^0(X) \oplus \bigoplus_{i,j} H^1(X) \otimes H^1(X), \]
and therefore
\[ H^2(X^{(n)}) = H^2(X) \oplus {\bigwedge}^2 H^1(X). \]
Now
\begin{align*} 
    H^2(X^{[n]}) &= H^2(X_*^{[n]}) \\ 
    &= {H^2(\Bl_{\Delta} X_*^n)}^{S_n}] \\
    &= {(\Im \eta^*)}^{S_n} \oplus {\qty(\bigoplus \Q E_{ij})}^{S_n} \\
    &= \eta^* {(H^2(X_*^n))}^{S_n} \oplus \Q E \\
    &= H^2(X) \oplus {\bigwedge}^2 H^1(X) \oplus \Q E.
\end{align*}
Over $\Z$, we can check in local coordinates that there exists a class $\delta \in H^2(X^[n], \Z)$ such that $2 \delta = E$.\footnote{We had a lengthy discussion checking the computations above, and the moral is that algebraic geometers are bad at basic algebra. Also, to avoid sign problems, work in characteristic $2$.}

\begin{cor}
    If $X$ is a K3 surface, then there is an isomorphism
    \[ H^2(X^{[n]}) = H^2(X) \oplus \Q E \]
    as Hodge structures, and in particular, 
    \[ H^0(\Omega^2_{X^[n]}) = H^{2,0}(X^[n]) \simeq H^2(X) = \C. \]
\end{cor}

We will now sketch the computation of the fundamental group of $X^{[n]}$. One fact is that
\[ h_* \colon \pi_1(X^{[n]}) \to \pi_1(X^{(n)}) = \pi_1(X) / [\pi_1(X), \pi_1(X)] = H_1(X, \Z) \]
is an isomorphism. In particular, if $X$ is a K3 surface, then $\pi_1(X^{[n]}) = 0$, so $X^[n]$ is irreducible holomorphic symplectic.

If $A$ is an abelian surface, we know $A$ has a holomorphic symplectic form $\sigma_A$, and thus $A^{[n]}$ has a holomorphic symplectic form $\sigma_{A^[n]}$, so $\omega_{A^{[n]}} = \mc{O}_{A^[n]}$. However, we know that $H^1(A^[n]) = H^1(A) = \Z^4$, so it is not simply connected. But then we know that 
\[ H^2(A^{[n]}) = H^2(A) \oplus {\bigwedge}^2 H^1(A) = H^2(A) \oplus H^2(A), \] 
so $A^[n]$ has larger $H^{2,0}$. By Beauville-Bogomolov, we know that $A^{[n+1]}$ has an \'etale cover by a product of complex tori, irreducible holomorphic symplectics, and strict Calabi-Yaus. There exists a natural morphism
\[ \mr{alb} \colon A^[n+1] \xrightarrow{h} A^{(n+1)} \to A \]
and an action of $A$ on $A^{[n+1]}$ given by translation. Of course, this is not equivariant because $\sum (z_i + a) \mapsto \sum z_i + (n+1)a$, and by generic smoothness all fibers are isomorphic and smooth. Now if we consider the diagram
\begin{equation*}
\begin{tikzcd}
    A \times_A A^[n+1] \ar{r} \ar{d} & A^{[n+1]} \ar{d}{\mr{alb}} \\
    A \ar{r}{n+1} & A,
\end{tikzcd}
\end{equation*}
we see that $A \times_A A^{[n+1]} = K_n(A) \times A$. Later, we will show that $K_n(A)$ is irreducible holomorphic symplectic.

\begin{exm}
    If $n = 1$, then $K_1(A)$ is the Kummer K3 surface associated to $A$.
\end{exm}

\begin{prop}\leavevmode
    \begin{enumerate}
        \item $\omega_{K^n(A)} = \mc{O}_{K^n(A)}$;
        \item The restriction of teh holomorphic symplectic form $\eval{\sigma_{A^{[n+1]}}}_{K^n(A)}$ is a symplectic form.
        \item $H^2(K^n(A)) = H^2(A) \oplus \Q F$ and $\pi_1(K^n(A)) = 1$, where $F$ is one of the fibers of $E \to A$, where $E \subset A^[n+1]$ is the exceptional divisor of $h$.
    \end{enumerate}
\end{prop}

We will prove a result that 
\begin{prop}
    There exists a (non-effective) line bundle $\mc{L}$ on $X^{[n]}$ such that $\mc{L}^{\otimes 2} = \mc{O}_{X^{[n]}}(E)$.
\end{prop}

\begin{proof}
    Consider $\Bl_{\Delta} X_*^n / A_{n}$. This has simple ramification over $E_* \subseteq X_*^{[n]}$, and thus $f_* \mc{O}_Z = \mc{O}_{X_*^{[n]}} \oplus \mc{L}$. This is the desired line bundle.
\end{proof}

\begin{cor}
    If $X$ is a K3 surface, then $\Pic(X^{[n]}) = \Pic(X) + \Z \delta$, where $\delta = c_1(\mc{L})$.
\end{cor}

\section{Generalized Kummers}%
\label{sec:generalized_kummers}

Recall the construction of the varieties $K^n(A)$ for an abelian surface $A$. Recall the diagram
\begin{equation*}
\begin{tikzcd}
    K^n(A) \ar[hookrightarrow]{r} \ar{dd} & A^{[n+1]} \ar{dd}{a} \ar{dr} & A^{n+1} \ar{d} \\
    & & A^{(n+1)} \ar{dl}{\ep} \\
    0_A \ar[hookrightarrow]{r} & A.
\end{tikzcd}
\end{equation*}
Also recall that $\pi_1(A^{[n+1]}) = \pi_1(A)$. Using the long exact sequence of homotopy groups and the fact that $A$ is a $K(\Z^4,1)$, we see that $\pi_1(K^n(A)) = 0$.

\begin{prop}
    $K^n(A)$ is an irreducible holomorphic symplectic manifold. In particular,
    \begin{enumerate}
        \item If $\sigma_{A^{[n+1]}}$ is the holomorphic symplectic form on $A^[n+1]$, then its restriction to $K^n(A)$ is a holomorphic symplectic form.
        \item $H^2(K^n(A)) = H^2(A) \oplus Q F$, where $F = E \cap K^n(A)$.
    \end{enumerate}
\end{prop}

\begin{proof}
    Consider the Leray filtration on $H^2(A^{[n+1]})$ induced by the map $a$. Here, we have
    \[ H^2(A) = H^2(a_* \Q) \subseteq H^2(A^{[n+1]}) \to H^0(A, R^2 a_* \Q) = {H^2(K^n(A))}^{\mr{inv}}, \]
    where invariants are taken with respect to the monodromy group of $a$, which is $A[n+1]$ because base change by $A \xrightarrow{n+1} A$ trivializes $a$. We will show that the last inclusion is an equality. Also, note that
    \[ H^2(A^{[n+1]}) = {\bigwedge}^2 H^1(A) \oplus H^2(A) \oplus \Q E \]
    and that if $\alpha, \beta \in H^1(A)$, then
    \[ a^* (\alpha \wedge \beta) = a^* \alpha \wedge a^* \beta = \sum p_i^* \alpha \wedge \sum p_i^* \beta. \]
    Next, write $K_*^n(A)$ analogously to $A_*^{[n]}$ and let $N = \ker(A^{n+1} \to A)$. Then we have a diagram
    \begin{equation*}
    \begin{tikzcd}
        & \Bl N_* \ar{dr} \ar{dl} \\
        K_*^n(A) \ar{dr} & & N_* \ar{dl} \\
        & K_*^{(n)}(A).
    \end{tikzcd}
    \end{equation*}
    Note that $N$ has an action of $S_{n+1}$ and an action of $A[n+1]$ given by adding $\ep$ to all elements that preserves $N$ and $\Delta$. Then we know that 
    \[ H^2(N_*) = H^2(N) = H^2(A^n) \]
    has an action of $A[n+1]$ has an action by translation, which is trivial in cohomology. Finally, we conclude that
    \[ H^2(K^n(A)) = H^2(K^n_*(A)) = {H^2(\Bl N_*)}^{S_{n+1}} \]
    and obtain the desired result.
\end{proof}

Now we have two examples of irreducible holomorphic symplectic manifolds. The first is $\mr{K3}^{[n]}$ with $b_2 = b_2(\mr{K3}) + 1 = 23$ and the second is $K^n(A)$ with $b_2 = b_2(A) + 1 = 7$.

\begin{prop}
    Let $f \colon \mc{X} \to B$ be a smooth proper morphism of complex manifolds such that for some $0 \in B$, $\mc{X}_0(B)$ is a K\"ahler irreducible holomorphic symplectic manifold. Then there exists an analytic neighborhood $0 \in V \subseteq B$ such that for all $t \in U$, $\mc{X}_t$ is K\"ahler and holomorphic symplectic.
\end{prop}

\begin{proof}
    By a result of Kodaira, being K\"ahler is an open condition, so there exists an open $U \subseteq B$ such that for all $t \in U$, $\mc{X}_t$ is K\"ahler. Therefore, for all $t \in U$, the map $t \mapsto h^p(\mc{X}_t, \Omega_{\mc{X}_t}^q)$ is constant by Ehresman's theorem that this family is topologically trivial and upper semicontinuity.

    This implies that up to further restricting $U$, $f_* \Omega^2_{\mc{X}/B}|_U$ is free. This implies that $\sigma_0 \in H^0(\Omega^2_{\mc{X}_0})$ extends locally to a section $\wt{\sigma} \in H^0(\mc{X}_U, \Omega^2_{\mc{X}_U/U})$. To check that this is symplectic, we know that $\wt{\sigma}^n \in H^0(K_{\mc{X}/U})$ has closed zero locus which does not intersect the zero fiber, and so we obtain an open set where this form is nondegenerate.
\end{proof}

\begin{prop}
    Let $f \colon \mc{X} \to B$ be a smooth proper family of K\"ahler manifolds. Then if $\mc{X}_0$ is irreducible holomorphic symplectic, so is $\mc{X}_t$ for all $t \in B$.
\end{prop}

\begin{proof}[Sketch of proof]
    First, note that the relative canonical bundle $K_{\mc{X}/B} \cong f^* \mc{L}$, where $\mc{L}$ is a line bundle on $B$. By the same proof as before, there exists $Z \subseteq B$ such that for all $t \in B \setminus Z$, $\mc{X}_t$ is irreducible holomorphic symplectic.

    Now suppose $t_0 \in Z$. Then $K_{\mc{X}_{t_0}}$ is trivial and $\mc{X}_{t_0}$ is simply connected, so $\mc{X}_{t_0}$ is a product of irreducible holomorphic symplectic varieties and strict Calabi-Yau manifolds.

Now we will state without proof the fact that if $X$ is a complex manifold with $K_X = \mc{O}_X$, then $\mr{Def}(X)$ is smooth (as a germ of complex manifold). This is a nontrivial result of Bogomolov-Tian-Todorov. Note that if $X_{t_0} = \prod X_i \times \prod Y_i$, then
    \[ \mr{Def}(X_{t_0}) = \prod \mr{Def}(X_i) \times \prod \mr{Def}(Y_i) \]
    because all $X_i, Y_i$ satisfy $h^{1,0} = 0$. Thus the splitting situation is impossible.
\end{proof}

It is known that if $S$ is a K3 surface, then $\mr{Def}(S)$ has dimension $20$. Also, note that projective K3 surfaces are a $19$-dimensional locus. Here, note that $\mr{Def}(X) = h^1(T_X) = h^1(\Omega^1_X) = h^{1,1}$.

In the next case, if $X = S^{[n]}$, then $\mr{Def}(X)$ has dimension $21$, and there is a $20$-dimensional locus of genuine Hilbert schemes of K3 surfaces. There are also higher-codimension loci parameterizing the spaces $M_v(S, h)$. Note that in both of these situations, the very general object is K\"ahler but not projective.

Now we will discuss some examples of Lagrangian fibrations.

\begin{exm}
    Let $f \colon S \to \P^1$ be an elliptic K3 surface. Then we have a morphism
    \[ S^{[n]} \xrightarrow{f} S^{(n)} \xrightarrow{f^{(n)}} {(\P^1)}^{(n)} = \P^n. \]
    This is clearly a Lagrangian fibration.
\end{exm}

\begin{exm}
    Let $A = E \times F$ be the product of two elliptic curves and let $\varphi \colon A \to F$ be the second projection. Then we have a diagram
    \begin{equation*}
    \begin{tikzcd}
        K^2(A) \ar[hookrightarrow]{r} \ar{d} & A^{[3]} \ar{d} \\
        K^{(2)}(A) \ar[hookrightarrow]{r} & A^{(3)} \ar{d} \ar{r}{\varphi^{(3)}} & F^{(3)} \ar{d}{\ep} & \ep^{-1}(0) \ar{d} \ar[hookrightarrow]{l} \\
        & A & F & 0_F \ar[hookrightarrow]{l}.
    \end{tikzcd}
    \end{equation*}
    Here, we see that $\ep^{-1}(0) = \check{\P}^2$, and so in general there is a Lagrangian fibration $K^n(A) \to \P^n$.
\end{exm}

\section{Some operations}%
\label{sec:some_operations}

Now we will consider some birational transformations. 

\begin{exm}[Atiyah flop]
    Let $f \colon \mc{S} \to \Delta$ be a family of quartic surfaces in $\P^3$. Suppose that $\mc{S}_t$ is smooth and $\mc{S}_0$ has one simple node $p \in \mc{S}_0$. This simple node is given locally by $x^2 + y^2 + z^2 = t$.

    Note that $\Bl_p \mc{S}_0 \eqqcolon \wt{\mc{S}}_0$ is a smooth K3 surface. We would like to modify the family such that we get smooth fibers for all $t \in \Delta$. Now if we take a base change of $\Delta$ by $t \mapsto t^2$, locally at $p \in \ol{\mc{S}}$ we have the equation $x^2 + y^2 + z^2 = t^2$ is a singular point of $\ol{\mc{S}}$. But then $\mc{X} \coloneqq \Bl_p \ol{\mc{S}}$ is smooth, and $\mc{X}_0 = \wt{\mc{S}}_0 \cup Q$, where $Q = \P^1 \times \P^1$.

    Unfortunately, the discrepancy of $\nu \colon \mc{X} \to \ol{\mc{S}}$ is $1$, so $K_{\mc{X}} = \nu^* K_{\ol{\mc{S}}} + Q$, and so by adjunction we see that
    \[ \omega_Q = (K_{\mc{X}} + Q)|_Q = \mc{O}(2Q)|_Q, \]
    and thus $\mc{O}_X(Q) = \mc{O}(-1,-1)$. This tells us that we can contract $Q$ along both of the factors and produce $\mc{S}^+, \mc{S}^-$ with maps to $\ol{\mc{S}}$. Then there is a birational map $\varphi \colon \mc{S}^+ \dashrightarrow \mc{S}^-$ which is an isomorphism away from the central fiber.

    We conclude that $\mc{S}_0^{\pm} = \wt{\mc{S}}_0$ and that $\varphi$ is an isomorphism outside of the copies of $\P^1$ that we contracted $Q$ onto but does not extend over those copies of $\P^1$. Also, note that $\mc{X} = \Gamma_{\varphi}$ and that $\mc{X}_t = \Gamma_{\varphi_t}$ for all $t \neq 0$, and $\mc{X}_0 = \wt{\mc{S}}_0 \cup \P^1 \times \P^1$.

    The next observation is that $H^2(\mc{S}^{\pm}_{t_0}) \simeq H^2(\wt{\mc{S}}_0)$, but passing between the two identifications is actually reflection across the $(-2)$-curve produced from the Atiyah flop.
\end{exm}

Here, we have used the following result of Nakano and Fujiki: Let $\wt{M}$ be a complex manifold and $E \subseteq \wt{M}$ be a smooth divisor that is a $\P^n$-bundle over some $Z$.. Then there exists a complex manifold $M \supset Z$ and $\pi \colon \wt{M} \to M$ such that $\wt{M} = \Bl_Z M$ if and only if $\mc{O}_{\wt{M}}(E)|_E = \mc{O}_X(-1)$.

Another fact that we used to show that $\mc{S}_0^+$ and $\mc{S}_0^-$ are isomorphic is that two birational K3 surfaces are isomorphic.

Now let $X \supseteq \P^n$ be a holomorphic symplectic manifold of dimension $2n$. For example, some K3 surfaces contain $(-2)$-classes, which are isomorphic to $\P^1$.

\begin{lem}
    Any such $\P^n \subseteq X$ is a Lagrangian submanifold of $X$. Moreover, if $Z \subseteq X$ is any Lagrangian, $N_{Z/X} \cong \Omega^1_{Z}$.
\end{lem}

\begin{proof}
    The first part is clear because $H^0(\Omega^2_{\P^n}) = 0$. Next, consider the exact sequencec
    \begin{equation*}
    \begin{tikzcd}
        0 \ar{r} & \mc{J}/\mc{J}^2 \ar{r} & \Omega^1_{X|Z} \ar{r} & \Omega^1_{Z} \ar{r} & 0 \\
        0 \ar{r} & T_{Z} \ar{r} \ar[hookrightarrow]{u} & T_{X|Z} \ar{u}{\sim} \ar{r} & N_{X/Z} \ar{r} \ar[twoheadrightarrow]{u} & 0.
    \end{tikzcd}
    \end{equation*}
    Note that the rightmost vertical morphism is generically injective with torsion kernel, but because $N_{X|\P^n}$ is torsion free, we have an isomorphism.
\end{proof}

Now consider $\Bl_{\P^n} X$ and let $E$ be the exceptional divisor. Denote $\P^n = \P V$ for some vector space $V$.

\begin{lem}
    We have an isomorphism $E \simeq I \subseteq \P V \times \P V^{\vee}$, where $I$ is the incidence subscheme. Moreover, we have $\mc{O}_{\wt{X}}(E) |_E \cong \mc{O}_E(-1, -1)$.
\end{lem}

\begin{proof}
    We know that $E = \P N_{\P^n/X} \simeq \P \Omega^1_{\P^n}$. Now if we consider the Euler sequence
    \[ 0 \to \Omega^1_{\P^n} \to V^{\vee} \otimes \mc{O}_{\P^n}(-1) \xrightarrow{ev} \mc{O}_{\P^n} \to 0, \]
    we obtain an embedding
    \[ \P \Omega^1_{\P^n} \subseteq \P V^{\vee} \times \P V \]
    as the locus $\qty{(s,x) \mid s(x) = 0}$. Next, we use adjunction in $\wt{X}$ and in $\P V \times \P V^{\vee}$ to see that
    \[ \mc{O}_X(-n, -n) = \omega_E = \omega_{\wt{X}}(E)|_E = \mc{O}_{\wt{X}}(nE)|_E. \]
\end{proof}

Now by the Nakano-Fujiki criterion, there exists $\wt{X}' \supseteq \P V$ and $q' \colon \wt{X} \to X'$ such that we have the following diagram:
\begin{equation*}
\begin{tikzcd}
    & \wt{X} \ar{dl} \ar{dr}{q'} \\
    X \ar[dashrightarrow]{rr}{\varphi} & & X'
\end{tikzcd}
\end{equation*}
such that $q'$ takes $E$ to $\P V^{\vee}$.

\begin{defn}
    Such an $X'$ is called the \textit{Mukai flop} of $X$ at $\P^n$.
\end{defn}

\begin{rmk}
    We can perform the Mukai flop whenever we have $Z \subseteq X$ such that there exists some $\P^r$-bundle structure $Z \to B$ and $Z$ has codimension $r$ in $X$. We also require that $N_{Z/X} \simeq \Omega^1_{Z/B}$.
\end{rmk}

\begin{rmk}
    We have a diagram
    \begin{equation*}
    \begin{tikzcd}
        & & \wt{X} \ar{dr} \ar{dl} \\
        \P^n \ar{dr} \ar[hookrightarrow]{r} & X \ar{dr}{\pi} \ar[dashrightarrow]{rr} & & X' \ar{dl} \\
        & p \ar[hookrightarrow]{r} & X_0.
    \end{tikzcd}
    \end{equation*}
\end{rmk}

\begin{rmk}
    If $X'$ and $X$ are isomorphic in codimension $2$, they have isomorphic $H^2$ and $X'$ is holomorphic symplectic.
\end{rmk}

The local structure of $(X_0, p)$ is isomorphic to that of the cone $C^{\bullet}(I)$. In particular, $X_0$ is not $\Q$-factorial because the exceptional locus of $\pi$ is $\P^n$, which is not a divisor. In addition, $\pi$ is a crepant (symplectic resolution).

\begin{prop}
    A birational map $f \colon X \dashrightarrow X'$ of compact complex manifolds (or projective varieties) with trivial canonical bundles is an isomorphism in codimension $2$. In particular, $\pi_1(X) = \pi_1(X')$ and $H^2(X, \Z) = H^2(X', \Z)$.
\end{prop}

\begin{proof}
    Let $\Gamma$ be the graph of $f$ and consider the diagram
    \begin{equation*}
    \begin{tikzcd}
        & \Gamma \ar{dl}{p} \ar{dr}{p'} \\
        X \ar[dashrightarrow]{rr}{f} & & X.
    \end{tikzcd}
    \end{equation*}
    Then if $E, F$ are the exceptional divisors of $p,p'$, we have $K_{\Gamma} = E = F$ up to linear equivalence. However, we know that $H^0(mF) = H^0(mE) = H^0(mK_{\Gamma}) = 1$, but these $h^0(\omega_X^{\otimes m})$ are birational invariants, so $E, F$ do not move in their equivalence class. In particular, we have an isomorphism $X \setminus p(E) \simeq X' \setminus p'(F)$.
\end{proof}

\begin{cor}
    Suppose that $f \colon X \twoheadrightarrow S'$ is a birational map of K3 surfaces. Then $f$ is an isomorphism.
\end{cor}

\begin{proof}
    Consider the graph $\Gamma$ and diagram
    \begin{equation*}
    \begin{tikzcd}
        & \Gamma \ar{dl}{p} \ar{dr}{q} \\
        X \ar[dashrightarrow]{rr}{f} & & S'.
    \end{tikzcd}
    \end{equation*}
    We know that $f$ is an isomorphism away from finitely many points. We know that $f$ is not defined at $x$ if and only if $p^{-1}(x)$ is a curve. But then there exists a curve $C' \subseteq S'$ contracted by $f^{-1}$, which is impossible.
\end{proof}

\begin{exm}[Beauville]
    This example comes from the paper \textit{Some remarks on K\"ahler manifolds with $c_1 = 0$} by Beauville.\footnote{This paper is written in English, but Giulia suggests that we read some math papers in French.} Let $S \subseteq \P^3$ be a quartic K3 surface. Choose a length $2$ point $z \in S^{[2]}$, which has linear span a line. But then $\ell \cap S = z + w$, and so we define a rational map $\varphi \colon S^{[2]} \dashrightarrow S^{[2]}$ given by $z + w$.
\end{exm}

\begin{prop}\leavevmode
    \begin{enumerate}
        \item $\varphi$ is regular at $[Z] \in S^{[2]}$ if and only if $\ell = \ev{Z} \not\subseteq S$.
        \item If $S \supseteq \ell_1, \ldots, \ell_k$ where the $\ell_i$ are disjoint lines, then $\varphi$ is the Mukai flop at $\ell_1^{[2]}, \ldots, \ell_k^{[2]}$.
    \end{enumerate}
\end{prop}

\begin{proof}\leavevmode
    We have a commutative diagram
    \begin{equation*}
    \begin{tikzcd}
        & \Gamma \ar{dl}{q_1} \ar{dr}{q_2} \\
        S^{[2]} \ar[dashrightarrow]{rr} \ar{dr}{p} & & S^{[2]} \ar{dl} \\
        & G = Gr(2,4),
    \end{tikzcd}
    \end{equation*}
    and clearly $p$ is finite over $[\ell] \in G$ if and only if $\ell \not\subseteq S$. In particular, if $\ell \subseteq S$, we have $p^{-1}([\ell]) = \ell^{[2]}$. Now consider the graph $\Gamma$ and note that $\Gamma \subseteq S^{[2]} \times_G S^{[2]} \subseteq S^{[2]} \times S^{[2]}$. Because $S^{[2]}$ is smooth, we know $\varphi$ is regular at $[Z]$ if and only if $q_1^{-1}(Z)$ is finite.

    But now $q_1^{-1}(Z) \subseteq S^{[2]} \times S^{[2]}$ is contained in $[Z] \times p^{-1}(\ell)$. Thus, if $p^{-1}(\ell)$ is finite, so is $q_1^{-1}(Z)$. For dimension reasons, if $\ell \subseteq S$ is a line, then $\ell^{[2]} \times \ell^{[2]}$ is an irreducible component of $S^{[2]} \times_G S^{[2]}$. But then $q_1^{-1}(\ell^{[2]}) = \Gamma \cap \ell^{[2]} \times \ell^{[2]}$, and then $S^{[2]} \times_G S^{[2]} \subseteq S^{[2]} \times S^{[2]}$ is a local complete intersection. But then irreducible components intersect in the correct dimension, so we are done.

    It remains to show that $f$ is the Mukai flop. We may assume that there is a unique line $\ell \subseteq S$. The key technical lemma is that $\varphi$ extends to $\Bl_{\ell^{[2]}} S^{[2]}$, which means we have a map
    \begin{equation*}
    \begin{tikzcd}
        \Bl_{\ell^{[2]}} S^{[2]} \ar{r}{\wt{\varphi}} \ar{d}{\pi} & \Bl_{\ell^{[2]}} S^{[2]} \ar{d}{\pi} \\
        S^{[2]} \ar[dashrightarrow]{r}{\varphi} & S^{[2]}.
    \end{tikzcd}
    \end{equation*}
    But then $\wt{\varphi}$ takes $E$ to itself, which means that it must swap the two rulings on $E$. But this means that the two copies of $\pi$ contract $E$ along the two rulings, as desired.

    To prove the lemma, $S^{[2]} \to G$ factors as $S^{[2]} \to Z \to G$, where $Z$ is normal and $Z \to G$ is finite. But then $\varphi$ descends to an honest morphism $\ol{\varphi} \colon Z \to Z$, and thus if $\ell^{[2]}$ is contracted to $z_0$, $\ol{\varphi}$ lifts to $\Bl_{z_0} Z = \Bl_{\ell^{[2]}} S^{[2]}$.
\end{proof}

\begin{prop}[Huybrechts]\label{prop:biratdefs}
    This proposition comes from the paper \textit{Birational symplectic manifolds and their deformations}. Let $\P^n \subseteq X^{2n}$, where $X$ is K\"ahler and symplectic and $f \colon X \dashrightarrow X'$ be the Mukai flop. Then there exist two birational smooth proper families
    \begin{equation*}
    \begin{tikzcd}
        \mc{X} \ar[dashrightarrow]{rr}{\phi} \ar{dr} & & \mc{X}' \ar{dl} \\
        & \Delta
    \end{tikzcd}
    \end{equation*}
    such that $\phi_t$ is an isomorphism for all $t \neq 0$, $\mc{X}_0 = X$, and $\mc{X}_0' = X'$.
\end{prop}

\begin{cor}
    There exists an isomorphism of Hodge structure $H^*(X) \simeq H^*(X')$.
\end{cor}

\begin{proof}
    Let $\Gamma \subseteq \mc{X} \times_{\Delta} \mc{X}'$ be the fiber product. Then we know $\Gamma_t = \Gamma_{\varphi_t} \subseteq \mc{X}_t \times \mc{X}_t'$, and this implies that
    \[ \gamma_t^* \colon H^*(\mc{X}_t') \to H^*(X_t) \qquad \alpha \mapsto p_1^* [\Gamma] \smile p_2^*(\alpha) \]
    is an isomorphism. But then we know $H^*(\mc{X}_t') \simeq H^*(\mc{X}_0')$ and similarly for $\mc{X}$. We also have a correspondence $\Gamma_0^*$, and this is an isomorphism.
\end{proof}

\begin{exm}
    Let $S \to \P^2$ be a degree $2$ K3 surface. Then we obtain some $\P^2 \subseteq S^{[2]}$. Then the Mukai flop of $S^{[2]}$ is a hyperk\"ahler manifold $M$ with a Lagrangian fibration over $\check{\P}^2$. Here, if $\ell \subset \P^2$ is a line, we consider $C \in \abs{f^* \mc{O}_{\P^2}(1)}$, and the fiber over $[C] \in\abs{C} = \check{\P^2}$ is simply $\Pic^2(C)$. In addition, the Mukai flop takes $z \in S^{[2]}$ to the line bundle $\mc{O}_C(Z)$.
\end{exm}

\begin{prop}
    Let $\P^n \subseteq X^{2n}$ be a K\"ahler holomorphic symplectic manifold and $f \colon X \dashrightarrow X'$ be the Mukai flop. Then there exist $\mc{X}, \mc{X}'$ over a disk $\Delta$ and $\phi_t \colon \mc{X} \to \mc{X}'$ such that $\phi_t$ is an isomorphism for $t \neq 0$, and ${(\Gamma_{\phi})}_0 = \Gamma_f + \P^n \times \check{\P}^n$.
\end{prop}

\begin{cor}
    There exists a universal deformation space for $X$ (as a germ of complex manifold).
\end{cor}

\begin{proof}
    We have an identity
    \[ T_{\mr{Def}(X)} = H^1(X, T_X) = \Ext^1_{\mc{O}_X}(\Omega^1_X, \mc{O}_X). \]
    Here, a deformation $v$ is taken to the exact sequence
    \begin{equation}\label{eqn:normal} 0 \to T_X \to T_{\mc{X}}|_X \to N_{X/\mc{X}} = \mc{O}_X \to 0. \end{equation}
    The first step in the proof is to show that there exists $\mc{X} \to \Delta$ such that $N_{\P^n/\mc{X}} = V^{\vee} \otimes \mc{O}_{\P^n}(-1)$. To do this, note that $H^1(X, T_X) = H^1(X, \Omega^1_X)$ and there is a sequence of maps
    \[ H^1(X, T_X) \to H^1(P, T_X |_P) \to H^1(P, N_{P/X}) = H^1(P, \Omega^1_P). \]
    We also have a map $H^1(X, \Omega^1_X) \to H^1(P, \Omega^1_P)$, and the resulting diagram commutes. We need to find $v \in H^1(X, T_X)$ such that $v|_P \neq 0$. Note that because $X$ is K\"ahler, there exists a K\"ahler form $\omega$ that restricts to a nonzero form on $P$. Next, the exact sequence (\ref{eqn:normal}) remains exact after restricting to $P$, and therefore we have
    \begin{equation*}
    \begin{tikzcd}
        0 \ar{r} & T_X |_P \ar{r} \ar{d} & T_{\mc{X}}|_P \ar{r} \ar{d} & N_{X/\mc{X}} |_P \ar{r} \ar[equal]{d} & 0 \\
        0 \ar{r} & N_{P/X} \ar{r} & N_{P/\mc{X}} \ar{r} & \mc{O}_P \ar{r} & 0.
    \end{tikzcd}
    \end{equation*}
    Because $v_P \neq 0$, the bottom sequence is not split, and because $v_P \in H^1(P, N_{P/X}) = H^1(P, \Omega^1_P)$ is contained in a $1$-dimensional vector space, the sequence is actually the Euler sequence, and thus $N_{P/\mc{X}} = V^{\vee} \otimes \mc{O}_{P}(-1)$.

    Next, we consider the exceptional divisor $\P(V^{\vee} \otimes \mc{O}(-1)) = \P V^{\vee} \times \P V$ of $\Bl_P X$, and we can check that $\mc{O}(E) |_E = \mc{O}(-1, -1)$. By Nakano-Fujiki, there exists a contraction of the exceptional divisor $E$ onto the first factor.
\end{proof}

\section{Deformations}%
\label{sec:deformations}

For this part, we will follow notes by Voisin from a class in 2006-07. Let $X$ be a compact complex manifold (or a reduced variety). We will see that
\[ T_{\mr{Def}_X} = \mr{Def}_X(\C[\ep]) = \Ext^1(\Omega^1_X, \mc{O}_X). \]
Fix $\Delta_n = \Spec \C[t]/t^{n+1}$. By reducedness, for every $\mc{X}_1 \to \Delta_1$, we assign the exact sequence
\[ 0 \to \mc{I}/\mc{I}^2 \to \Omega^1_{\mc{X}}|_X \to \Omega^1_X \to 0. \]
\begin{rmk}
    The sheaf $\Omega^1_{\mc{X}}$ has torsion, but its restriction to the central fiber is locally free if $X$ is smooth. 
\end{rmk}
Conversely, given
\[ 0 \to \mc{O}_X \to \mc{E} \to \Omega^1_X \to 0, \]
we want to define an algebra $\mc{O}_{\mc{X_1}}$ fitting in
\[ 0 \to \mc{O}_X \to \mc{O}_{\mc{X}_1} \to \mc{O}_X \to 0. \]
Equivalently, we want a sheaf $A$ and $A \to \mc{E}$ commuting with the inclusion of $\mc{O}$ and the differentia $d$. We simply set
\[ A = \qty{(\alpha, f) \in \mc{E} \oplus \mc{O}_X} \mid r(\alpha) = \dd{f}, \]
where $r \colon \mc{E} \to \Omega^1_X$ is the map in the exact sequence above. To define the algebra structure, we simply set
\[ (\alpha, f) (\beta, g) = (\alpha g + \beta f, fg). \]
It remains to check that the kernel of $A \to \mc{O}_X$ is a square zero ideal.

Next, we will consider global deformations of $X$ a compact complex structure. We can consider the deformations of $X$ over either germs of complex spaces or local Artinian rings. 

\begin{thm}[Kuranishi]
    If $H^0(X, T_X) = 0$, then there exists a universal family $\mc{X} \to \mr{Def}(X)$ over a germ of (pointed) complex analytic spaces.
\end{thm}

Alternatively, using the point of view of Schlessinger, because $H^0(T_X) = 0$, then $\mr{Def}_X(-)$ satisfies the axiom $H_4$ and is thus pro-representable.

\begin{rmk}
    There is generally no chance of having an algebraic family. Unfortunately, even if the central fiber is algebraic, there are arbitrarily small deformations that are not algebraic. If you want to keep everything algebraic, then we need to mark $X$ with an ample line bundle.
\end{rmk}

\begin{thm}[Bogomolov, Tian, Todorov]
    Let $X$ be a compact K\"ahler Calabi-Yau manifold with $H^0(T_X) = 0$. Then the germ of space $(\mr{Def}(X), 0)$ is smooth (equivalently, the pro-representing ring $R$ is a formal power series ring).
\end{thm}

The proof of this result uses the $T^1$-lifting principle, resting on the fact that by the infinitesimal lifting principle, smoothness of $\mr{Def}(X)$ at $0$ is equivalent to the fact that deformations can be lifted to any order. Before we do this, we need some notation and results.

\begin{lem}
    Given an $n$-th order deformation $f_n \colon \mc{X}_n \to \Delta_n$, the sheaves $\Omega^1_{\mc{X}_n} |_{\mc{X}_{n-1}}$ and $\Omega^1_{\mc{X}_{n-1}/\Delta_{n-1}}$ are both locally free. Moreover, they fit into an exact sequence
    \[ 0 \to \mc{O}_{X_{n-1}} \xrightarrow{\dd{t}} \Omega^1_{\mc{X}_n} |_{\mc{X}_{n-1}} \to \Omega^1_{\mc{X}_{n-1} / \Delta_{n-1}} \to 0. \]
\end{lem}

\begin{proof}
    Note that $\Omega^1_{\Delta_n} = \qty{\dd{t} \mid t^n \dd{t} = 0}$. Then the sheaf $\Omega^1_{\Delta_n} |_{\Delta_{n-1}}$ is locally free of rank $1$ generated by $\dd{t}$. Now because $X$ is smooth, $\wh{\mc{O}}_X \simeq \C[[x_1, \ldots, x_m]]$, and in fact we have isomorphisms
    \[ \C[[x_1, \ldots, x_m, t]] / t^{n+1} \simeq \wh{\mc{O}}_{\mc{X}_n} \]
    for all $n$. This implies that $\Omega^1_{\mc{X}_n}$ is locally generated by $\dd{x_1}, \ldots, \dd{x_m}, \dd{t}$ with $t^n \dd{t} = 0$. In particuar, after killing $t^n$, we see that $\Omega^1_{\mc{X}_n} |_{\mc{X}_{n-1}}$ is locally free and generated by the $\dd{x_i}$. We know the exact sequence
    \[ f^* \Omega^1_{\Delta_n} \to \Omega^1_{X_n} \to \Omega^1_{X_n/\Delta_n} \to 0, \]
    and restricting to $\mc{X}_{n-1}$, we obtain the desired result.
\end{proof}

\begin{defn}
    Given $f_n \colon \mc{X}_n \to \Delta_n$, set
    \[ e_n \coloneqq [0 \to \mc{O}_{\mc{X}_{n-1}} \to \Omega^1_{\mc{X}_n} |_{X_{n-1}} \to \Omega^1_{\mc{X}_{n-1} / \Delta_{n-1}} \to 0] \in \Ext^1_{X_{n-1}}(\Omega^1_{\mc{X}_{n-1}/\Delta_{n-1}}, \mc{X}_{\mc{X}_{n-1}}). \]
    This is called the \textit{Kodaira-Spencer class}.
\end{defn}

\begin{rmk}
    By the lemma, we have
    \[ \Ext^1(\Omega^1_{\mc{X}_{n-1} / \Delta_{n-1}}, \mc{O}_{\mc{X}_{n-1}}) = H^1(T_{X_{n-1}/\Delta_{n-1}}). \]
\end{rmk}

\begin{thm}[Ran]
    Let $X$ be a compact complex manifold. Given $\mc{X}_n \to \Delta_n$, there exists a lift $f_{n+1} \colon \mc{X}_{n+1} \to \Delta_{n+1}$ if and only if $e_n$ lifts to some class $e_{n+1} \in H^1(T_{\mc{X}_n/\Delta_n})$, where the map
    \[ H^1(T_{\mc{X}_n / \Delta_n}) \to H^1(T_{\mc{X}_{n-1}} / \Delta_{n-1}) \]
    is induced as follows: make the identification
    \[ D \in \Der_{\Delta_n}(\mc{O}_{\mc{X}_n}, \mc{O}_{\mc{X}_n}) = T_{\mc{X}_n/\Delta_n} \mapsto D |_{\mc{X}_{n-1}}. \]
    Equivalently, given an extension
    \[ 0 \to \mc{O}_{\mc{X}_n} \to \mc{E} \to \Omega^1_{\mc{X}_n/\Delta_n} \to 0, \]
    everything is locally free, so we can restrict to $\Delta_{n-1}$ and use the identity $\Omega^1_{\mc{X}_n/\Delta_n} |_{\mc{X}_{n-1}} = \Omega^1_{\mc{X}_{n-1}/\Delta_{n-1}}$.
\end{thm}

\begin{lem}
    The algebra $\mc{O}_{\mc{X}_{n+1}}$ is determined by $\mc{O}_{X_n}$ and the short exact sequence
    \[ 0 \to \mc{O}_X \xrightarrow{t^{n} \dd{t}} \Omega^1_{\mc{X}_{n+1}}|_{\mc{X}_n} \xrightarrow{r} \Omega^1_{\mc{X}_n} \to 0. \]
\end{lem}

As we did earlier, we construct $A$ to fit into the exact sequence
\[ 0 \to \mc{O}_X \xrightarrow{t^n} A \to \mc{O}_{\mc{X}_n}. \]

\begin{proof}[Sketch of proof of theorem]
    One direction is clear. If there is a lift, we construct the class $e_{n+1}$ and clearly, it must restrict to $e_n$ by definition.

    In the other direction, suppose there is a class $e_{n+1}$ lifting $e_n$. We want to construct $\mc{O}_{X_{n+1}}$. Given this $e_{n+1}$, we will find $\mc{E}$ fitting into the sequence
    \[ 0 \to \mc{O}_{\mc{X}_n} \to \mc{E} \to \Omega^1_{\mc{X}_n / \Delta_n} \to 0. \]
    Given any $\mc{E}$ as above, there exists an isomorphism $\Omega^1_{\mc{X}_n} |_{\mc{X}_{n-1}} \simeq \mc{E} |_{\mc{X}_{n-1}}$ induced by a surjection $r \colon \mc{E} \to \Omega^1_{\mc{X}_n}$. This will give us the desired algebra.

    To prove that such an isomorphism exists, by the existence of $e_{n+1}$, we already have a surjection $f_1 \colon \mc{E} \to \Omega^1_{\mc{X}_n / \Delta_n}$. Then after restricting to $\mc{X}_{n-1}$, we have a sequence
    \[ \mc{E} \xrightarrow{f_2} \mc{E} \_{\mc{X}_{n-1}} \simeq \Omega^1_{\mc{X}_n} |_{\mc{X}_{n-1}} \xrightarrow{g_2} \Omega^1_{\mc{X}_{n-1} / \Delta_{n-1}}. \]
    We now claim that
    \[ \Omega^1_{\mc{X}_n} \subseteq \Omega^1_{\mc{X}_n / \Delta_n} \oplus \Omega^1_{\mc{X}_n} |_{\mc{X}_{n-1}} \xrightarrow{g_1,g_2} \Omega^1_{\mc{X}_{n-1} / \Delta_{n-1}}, \]
    Because $g_1 \circ f_1 = g_2 \circ f_2$, we have our desired $r \colon \mc{E} \to \Omega^1_{\mc{X}_n}$.

    Next, we show that $\ker r \simeq \mc{O}_X$. We have a short exact seqeunce defining $\mc{E}$, and then we obtain a diagram
    \begin{equation*}
    \begin{tikzcd}
        & \mc{O}_X \ar{r}{\sim} \ar{d}{t^n} & \ker r \ar{d} \\
        0 \ar{r} & \mc{O}_{\mc{X}_n} \ar{r} \ar{d} & \mc{E} \ar{r} \ar{d}{r} & \Omega^1_{\mc{X}_n/\Delta_n} \ar{r} \ar[equal]{d} & 0 \\
        f^* \Omega^1_{\Delta_n} \ar[twoheadrightarrow]{r} & \mc{O}_{\mc{X}_{n-1}} \ar{r} & \Omega^1_{\mc{X}_n} \ar{r} & \Omega^1_{\mc{X}_n} \ar{r} & 0.
    \end{tikzcd}
    \end{equation*}
    Constructing $A \subseteq \mc{E} \oplus \mc{O}_{\mc{X}_n}$ as we did before, we are done.
\end{proof}

To prove that $\mr{Def}(X)$ is smooth when $X$ is a compact Calaby-Yau, we need to check the $T^1$ lifting principle. In order to do this, we need some Hodge theory.

\begin{lem}
    The sequence
    \[ \mc{O}_X \xrightarrow{\partial} \Omega^1_{X} \xrightarrow{\partial} \Omega^2_X \to \cdots \]
    is a resolution of the constant sheaf $\C$ in the analytic topology.
\end{lem}

\begin{cor}
    $H^k(X, \C) = H^k(X, \Omega^{\bullet})$.
\end{cor}

This gives us a filtration b\^ete (for stupid filtration) $F^p \Omega^{\bullet}_X = \Omega_X^{\geq p}$, which by standard techniques leads to a spectral sequence where
\[ E_1^{p,q} = H^q(\Omega_X^p) \Rightarrow \mr{gr}_F H^k(X, \Omega^{\bullet}_X) \]
which comes from the filtration $F^p H^k(\Omega^{\bullet}_X) = \Im (H^k(\Omega_X^{\geq 0}) \to H^k(\Omega_X^{\bullet}))$.

If $X$ is K\"ahler and compact, then the Hodge theorem implies that this spectral seqeunce (called the Frolicher spectral sequence) at the $E_1$-page and that $F^p H^k(X, \C)$ is the Hodge filtration. To see this, note that
\[ b_k(X) = \dim E_{\infty}^{p,q} \leq \sum \dim E_{1}^{p,q} = \sum h^{p,q} = b_k(X). \]
Deligne in the paper \textit{Th\'eor\`eme de Lefschetz et Crit\`eres de D\'eg\'en\'erescence de Suites Spectrales}  shows that if $X$ is any smooth proper scheme over $\C$, the Frolicher spectral sequence degenerates at $E_1$.

Previously, we considered $\mc{X} \to B$ smooth proper morphisms of complex manifolds. then if $X_0$ is K\"ahler, the $h^{p,q}(X_t)$ are locally constant, and in fact the degeneration of the Frolicher spectral sequence at $E_1$ is enough. Thus if $B$ is a complex manifold, the sheaves $R^q f_* \Omega^p_{X/B}$ are locally free and satisfy base change.

\begin{prop}
    Let $f \colon \mc{X} \to B$ be smooth and proper with $B$ a scheme over $\C$ (possibly of finite type). Then the higher direct images $R^k f_* \Omega^{\bullet}_{X/B}$ and $R^q f_* \Omega^p_{X/B}$ are locally free and satisfy base change. Moverover, there exists a filtration $\mc{F}^p R^k f_* \Omega^{\bullet}_{\mc{X}/B}$ whose successive quotients are locally free and whose associated graded components are $R^q f_* \Omega^p_{\mc{X}/B}$.
\end{prop}

\begin{lem}[Deligne]
    Let $A$ be a local Artinian ring over $\C$ and $K^{\bullet}$ be a bounded above complex of free $A$-modules. Then $\ell_A(H^n(K^{\bullet})) \leq \ell(A) \cdot \ell_{\C} H^n(K^{\bullet} \otimes_A \C)$, and if equality holds, then base change holds in degree $n, n+1$, which means that for $j = n, n+1$, we have
    \[ H^j(K^{\bullet}) \otimes_A N \simeq H^j(K^{\bullet} \otimes_A N), \]
    where $N$ is any $B$-module of finite type for some Artinian $A$-algebra $B$. In addition, $H^n(K^{\bullet})$ is a free $A$-module.
\end{lem}

\begin{proof}[Proof of proposition]
    We will reduce to the case of $B = \Spec A$, where $A$ is an artinian ring over $\C$. Recall that we have an exact sequence
    \[ 0 \to f^* \Omega^1_B \to \Omega^1_X \to \Omega^1_{X/B} \to 0. \]
    Then we have the relative de Rham complex which resolves
    \[ f^{-1} \mc{O}_B \to \Omega^{\bullet}_{X/B}. \]
    Now because $B$ is affine, we note that
    \[ R^k f_* \Omega^{\bullet}_{X/B} = H^k(X, f^{-1}\mc{O}_B) = H^k(X, A) = H^k(X_0, \C) \otimes_{\C} A \]
    by $A$-linearity of the differential. Thus $\mc{H}^k R^k f_* \Omega^{\bullet}_{X/B}$ is a free $A$-module (in the general case, we obtain $R^k f_* \Omega^1_{X/B} = (R^k f_* \C) \otimes \mc{O}_B$).

    Now we consider the stupid filtration $\mc{F}^p \Omega^{\bullet}_{X/B} = \Omega^{\geq p}_{X/B}$ and this induces a spectral sequence
    \[ E_1^{p,q} = R^q f_* \Omega^p_{X/B} \Rightarrow \mr{Gr}_F R^k f_* \Omega^{\bullet}_{X/B}, \]
    where $\mc{F}^p R^k f_* \Omega^{\bullet}_{X/B} = \Im (R^k \mc{F}^p \Omega^{\bullet}_{X/B} \to R^k \Omega^{\bullet}_{X/B})$. We now have
    \begin{align*} 
        \ell(A) \cdot b_k(X_0) &= \ell (R^k f_* \Omega^{\bullet}_{X/B}) \\
        &= \sum_{p+q=k} \ell(E_{\infty}^{p,q}) \\
        &\leq \sum_{p+q=k} \ell(E_1^{p,q})  \\
        &= \sum \ell(R^q f_* \Omega^p_{X/B}) \\
        &\leq \ell(A) \sum \ell(H^q(\Omega^p_{X_0})) \\
        &= b_K(X_0) \cdot \ell(A)
    \end{align*}
    by the lemma, so all inequalities are equalities. Using the lemma again, the $R^p f_* \Omega^q_{X/B}$ are free $A$-modules and satisfy base change. The remainder of the result is easy to see.
\end{proof}

\begin{proof}[Proof of Bogomolov-Tian-Todorov]
    Given $\mc{X}_n \to \Delta_n$, we have a class $e_n \in H^1(T_{X_{n-1}/\Delta_{n-1}})$, and we want to lift this to $H^1(T_{X_n} / \Delta_n)$. Suppose that $X_0$ is a compact Calabi-Yau such that the Frolicher spectral sequence degenerates at $E_1$ and $\dim X_0 = m$. Then $\Omega^m_{X_n/\Delta_n} \cong \mc{O}_{X_n}$, so there exists a perfect pairing
    \[ \Omega^1_{X_n/\Delta_n} \otimes \Omega^{m-1}_{X_n / \Delta_n} \to \Omega^m_{X_n / \Delta_n} \simeq \mc{O}_{X_n}. \]
    Thus $T_{X_n/\Delta_n} \simeq \Omega^{m-1}_{X_n/\Delta_n}$. If we consider
    \[ R^q f_{n*} \Omega^{m-1}_{X_n/\Delta_n} = H^1(\Omega^{m-1}_{X_n/\Delta_n}) \to H^1(\Omega^{m-1}_{X_{n-1}/\Delta_{n-1}}) = R^1 f_{n-1,*} \Omega^{m-1}_{X_{n-1}/\Delta_{n-1}} = R^1 f_* \Omega^{m-1}_{X_n/\Delta_n} |_{X_{n-1}}, \]
    we are done.
\end{proof}

\section{Some Hodge theory}%
\label{sec:some_hodge_theory}

Let $f \colon \mc{X} \to B$ be a proper surjective smooth morphism either of schemes over $\C$ or with K\"ahler fibers $X_b$. Let
\[ \mc{H}^k \coloneqq R^k f_* \Omega^{\bullet}_{X/B} = R^k f_* \C \otimes_{\C} \mc{O}_B \]
be the Hodge bundle. Then there is a decreasing filtration $\mc{F}^p \mc{H}^k \subset \mc{H}^k$ in subbundles. Now suppose that $B$ is sufficiently small so that $\mc{H}^k = H^k(X_0, \C) \otimes \mc{O}_B$ is free.

\begin{thm}
    Fix $k, p$. Then there is a holomorphic map, called the \textit{period mapping}, 
    \[ B \xrightarrow{\varphi} \mr{Gr}(f_k^p, H^k(X_0, \C)) \qquad b \mapsto F^p H^k(X_b) \subseteq H^k(X_b, \C) \cong H^k(X_0, \C), \]
    where $f_k^p = \sum_{\ell \geq p} h^{\ell, k-\ell}(X_0)$. Pulling back the tautological seqeunce on the Grassmannian gives $\mc{F}^p \mc{H}^k \subseteq \mc{H}^k$.
\end{thm}

We would like to study $\varphi$, and a first step is to study its differentials. Note that $\varphi$ factors via the universal deformation space $\mr{Def}(X_0)$, so we have a diagram
\begin{equation*}
\begin{tikzcd}
    B \ar{rr}{\varphi} \ar{dr} & & \mr{Gr}(f_k^p, H^k(X_0)) \\
    & \mr{Def}(X_0) \ar{ur}{\wp}.
\end{tikzcd}
\end{equation*}
Now recall that $T_{[W]} \mr{Gr}(j, V) = \Hom(W, V/W)$, and so the differential of the period map is a morphism
\[ H^1(T_X) \xrightarrow{\dd{\wp_0}} \Hom(F^p H^k, H^k / F^p H^k). \]
This factors through $\Hom(F^p, F^{p-1}/F^p)$ by Griffiths transversality, and so we have the diagram
\begin{equation*}
\begin{tikzcd}
    H^1(T_X) \ar{rr} \ar{dr} & & \Hom(F^p, F^{p-1}/F^p) \ar{dl} \\
    & \Hom(F^p/F^{p-1}, F^{p-1}/F^p),
\end{tikzcd}
\end{equation*}
and the bottom term in the diagram is isomorphic to $\Hom(H^{k-p}(\Omega^p_X), H^{k-p+1}(\Omega^{p-1}_X))$.

\begin{prop}
    The morphism $H^1(X, T_X) \to \Hom(H^{k-p}(\Omega^p_X), H^{k-p+1}(\Omega_X^{p-1}))$ is the morphism sending a tangent vector $v$ to the morphism induced by contraction by $v$.
\end{prop}

Returning to irreducible holomorphic symplectic manifolds, let $X$ be irreducible holomorphic symplectic. Then the Hodge filtration here gives
\[ F^2 H^2 = H^0(\Omega^2_X) = C \sigma \qquad F H^2 \twoheadrightarrow H^1(\Omega^1_X), H^2(X) \twoheadrightarrow H^2(\mc{O}_X) = \C \ol{\sigma}. \]
Then the period map is a morphism
\[ \mr{Def}(X) \xrightarrow{\wp} \P H^2(X, \C) \qquad t \mapsto \C \sigma_t, \]
where we have made an identification $\eta_t \colon H^2(X_t, \C) \cong H^2(X_0, \C)$.

\begin{prop}
    The differential $\dd{\wp_0}$ has maximal rank.
\end{prop}

\begin{proof}
    Write the morphism
    \begin{equation*}
    \begin{tikzcd}
        H^1(T_X) \ar{r}{\dd{\wp_0}} \ar{dr} & \Hom(H^{2,0}, H^2/H^{2,0}) \ar{d} \\
        & \Hom(H^{2,0}, F^1 H^2 / H^{2,0}).
    \end{tikzcd}
    \end{equation*}
    It is enough to show that the morphism $H^1(T_X) \to \Hom(H^{2,0}, F^1 H^2 / H^{2,0}) = H^1(\Omega^1)$ is an isomorphism. But this map is given by contraction, and so it is precisely the isomorphism $T_X \simeq \Omega^1_X$ induced by $\sigma$.
\end{proof}
We conclude that $\wp$ is an isomorphism onto its image. There will be a local statement, where we consider small deformations, and a global statement, where we consider the entire moduli space. First, note that $\dim \mr{Def}(X) = b_2 - 2$ and $\dim \P H^2(X) = b_2 - 1$.

\begin{prop}
    There exists a quadric hypersurface $Q \subseteq \P H^2(X, \C)$ such that $\Im \wp \subseteq Q$.
\end{prop}

\begin{proof}
    First note that $\Im \wp$ is contained in a degree $2n$-hypersurface, where $\dim X = 2n$. There is a natural degree $2n$ polynomial on $H^2$ given by the cup product of $H^2$ with itself $2n$ times. By type reasons\footnote{This sounds a lot like computer science.}, because $\sigma_{X_t}$ is a $(2,0)$-form, we know $\sigma_{X_t}^{2n} = 0$, and thus $\sigma_t^{2n} = 0$. Thus if $F$ is the cup product polynomial, we see, $\Im \wp \subseteq \qty{F = 0} \subseteq \P H^2(X, \C)$. (Note that for K3 surfaces, we are done and that this quadric is defined over $\Z$. In fact, the $H^2(S, \Z)$ is a unimodular lattice.)

    Now we will prove that $F = q^n$ up to a constant. To do this, we will prove that $F$ vanishes with order at least $n$ on $\Im \wp$ and then write down a quadric explicitly. Write $\sigma_t = \sigma_0 + t \alpha$, and so we have
    \begin{align*}
        \sigma_t^{2n} &= {(\sigma_0 + t \alpha)}^{2n} \\
        &= \sigma_0^{2n} + t \sigma_0^{2n-1} \alpha + \cdots + t^n \sigma^n \alpha.
    \end{align*}
    Thus $F$ vanishes up to order $n$, as desired.
\end{proof}

\begin{thm}[Beauville, Bogomolov, Fujiki]
    Let $X$ be irreducible holomorphic symplectic manifold of dimension $2n$. There exists an integral, indivisible, quadratic form $q \colon H^2(X, \C) \to \C$ of signature $(3, b_2 - 3)$ and a constant $c_X \in \Q_{>0}$ such that 
    \[ \int_X \alpha^{2n} = c_X {q(\alpha)}^n \] 
    for all $\alpha \in H^2(X)$.
\end{thm}
Note that the relation, called the \textit{Fujiki relation}, identifies $q, c_X$ with no ambiguity except when $n$ is even, in which case we specify $q(\omega) > 0$ for $\omega$ K\"ahler. Moreover:
\begin{itemize}
    \item $\Im \wp \subseteq \Omega = \qty{ q(x) = 0, q(x,\ol{x}) > 0} \subseteq \Q$. In particular, the map $\wp \colon \mr{Def}(X) \to \Omega$ is a local isomorphism.
    \item With respect to $q$, $H^{1,1} \perp H^{2,0} \oplus H^{2,0}$.
\end{itemize}

\begin{proof}
    We will normalize $\sigma$ such that $\int {(\sigma \ol{\sigma})}^n = 1$. For a class $\alpha = a \sigma + \omega + b \ol{\sigma}$, we will define
    \begin{align*} 
        q(\alpha) &= ab + \int {(\sigma \ol{\sigma})}^{n-1} \cdot \omega^2  \\
        &= \frac{n}{2} \int {(\sigma \ol{\sigma})}^{n-1} \alpha^2 + (1-n) \qty(\int \sigma^{n-1} \ol{\sigma}^n \alpha) \cdot \qty(\int \sigma^n \ol{\sigma}^{n-1} \alpha).
    \end{align*}
    First we check that if $\omega$ is a K\"ahler form, then $q(\omega) > 0$. In fact, we have
    \[ q(\alpha) = \int {(\sigma \ol{\sigma})}^{n-1} \cdot \omega^2, \]
    and now we use the Hodge-Riemann bilinear relations. Here, if $M$ is compact and K\"ahler with $\dim M = m$ and $\omega$ a K\"ahler form, define
    \[ (\alpha, \beta) \coloneqq \int \alpha \wedge \ol{\beta} \wedge \omega^{m-k}. \]
    Then the bilinear form
    \[ i^{p-q} {(-1)}^{\frac{k(k-1)}{2}} (-,-) |_{H^{p,q}_{\mr{prim}}} \]
    is positive-definite. In our situation, note that $\sigma^{n-1}$ is a primitive form, and so we obtain the desired result. It is clear that $q(\sigma) = 0, q(\Re(\sigma)) = q(\Im(\sigma)) > 0$, and $q(\Re(\sigma), \Im(\sigma)) = 0$, and so $q$ has rank at least $3$ and is thus irreducible.

    We now prove the Fujiki relation. By type reasons, we have $\sigma_t^{n+1} = 0$, and so if we write $a_t \sigma + \omega_t + b_t {\ol{\sigma}}$, and thus
    \[ {(\sigma_t^{n+1})}_{2n,2} = 0 = a_t^n b_t \sigma^n \ol{\sigma} + a_t^{n-1} \sigma^{n-1} \omega^2, \]
    and when we multiply by $\ol{\sigma}^{n-1}$, we have
    \[ 0 = a_t^{n-1} \qty(a_t b_t + \int {(\sigma \ol{\sigma})}^{n-1} \omega^2). \]
    Because $a_t \neq 0$ for sufficiently small $t$, we see $q(\sigma_t) = 0$, and thus $(q) = I(\Im(\wp)) \ni F$, which gives us the Fujiki relation.

    We will compute the signature of $q$. If we differentiate the equation
    \[ \int \alpha^{2n} = c {q(\alpha)}^{n} \]
    with respect to $t$ under $\alpha + t \beta$, we have
    \[ 2n \cdot \alpha^{2n-1} \beta = 2n c {q(\alpha)}^{n-1} q(\alpha, \beta). \]
    Now if $\omega$ is K\"ahler form, then $\beta$ is primitive if and only if $q(\omega, \beta) = 0$. It is now enough to compute the sign of $q |_{H^{1,1}_{\mr{prim}}}$. Differentiating again, we obtain
    \[ (2n-1) \alpha^{2n-2} \beta \wedge \gamma = 2(n-1) c {q(\alpha)}^{n-2} 2(\alpha, \gamma) q(\alpha, \beta) + c {q(\alpha)}^{n-1} q(\gamma, \beta). \]
    Choosing $\alpha = \omega$ to be K\"ahler and $\beta, \gamma$ primitive, we obtain
    \[ (2n-1) \alpha^{2n-2} \beta \wedge \gamma = c {q(\alpha)}^{n-1} q(\gamma, \beta), \]
    and by the Hodge-Riemann bilinear equations, the left-hand-side is negative.

    Finally, we need to prove integrality. For all $\lambda, \alpha \in H^2(X, \C)$, we have
    \[ {(\lambda^{2n})}^2 q(\alpha) = q(\lambda) [(2n-1) \lambda^{2n}(\lambda^{2n-2} \alpha^2) - (2n-1) {(\lambda^{2n-1} \alpha)}^2]. \]
    This is obtained from previous formulae by multiplying the derivative of the Fujiki repation by $q(\alpha)$, using the Fujiki relation, and taking the derivative again.
\end{proof}

\begin{cor}
    Up to multiplication by a nonzero constant, we can assume that if $\alpha \in H^2(X,\Q)$, then $q(\alpha) \in \Q$.
\end{cor}

\begin{proof}
    We prove that there exists $\lambda \in H^2(X, \Q)$ such that $q(\lambda) \neq 0$. The class $\sigma + \ol{\sigma} \in H^2(X, \R)$ and $q(\sigma + \ol{\sigma}) > 0$, so by density of $H^2(X, \Q) \subset H^2(X, \R)$, we are done.
\end{proof}

Once we have this normalization, we have proven the integrality statement in Beauville-Bogomolov-Fujiki.

\begin{rmk}
    The Fujiki relation implies that both $q(-)$ and $c_X \in \Q_{>0}$ in the relation
    \[ \int \alpha^{2n} = c_X {q(\alpha)}^n \]
    are deformation invariants.
\end{rmk}

Using the Hodge-Riemann bilinear relations, we see that restricting $q$ to $H^{2,0} \oplus H^{0,2}$ (as a real vector space) is positive definite. In addition, a basis of $H^{2,0} \oplus H^{0,2}$ is $\Re \sigma, \Im \sigma$, and in fact $q(\Re \sigma, \Im \sigma) = 0$.

Now the period map $\wp \colon \mr{Def}(X) \to Q$ lands in the set 
\[ \Omega = \qty{x \mid q(x) = 0, q(x+\ol{x}) > 0}. \]
This set $\Omega$ is called the \textit{period domain}.

\begin{rmk}
    The points of $\Omega$ parameterize Hodge structures on $H^2(X, \Z)$ of K3-type ($1, b_2-2, 1$). These structures have $x \in H^2(X, \C)$ with $q(x) = 0, q(x, \ol{x}) > 0$, and then $H^{1,1}$ is the orthogonal complement of $x$.
\end{rmk}

We hope that for every Hodge structure, there is some manifold realizing the Hodge structure, but this is a highly nontrivial result of Huybrechts.

\begin{prop}
    There exists a natural diffeomorphism $\Omega \simeq \mr{Gr}^+(2, H^2(X, \R))$, where the $+$ means that for a subspace $W$, we have both an orientation and positive-definiteness of $q |_W$ given by
    \[ \sigma \mapsto \ev{\Re \sigma, \Im \sigma} \qquad W = \ev{w_1, w_2} \mapsto w_1 + i w_2. \]
\end{prop}

Now we consider the case of K3 surfaces. We know that if $X = S$ is a K3 surface, then $q$ is simply the cup product. To say more about this, first we will prove
\begin{prop}
    We have an identity $c_2(S) = 24 \in H^4(S, \Z) = \Z$, and of course this means $b_2(S) = 22$ and $h^{1,1} = 20$. In addition, we have $H^2(S, \Z) = {E_8(-1)}^{\oplus 2} \oplus U^{\oplus 3}$, where $U = \begin{psmallmatrix} 0 & 1 \\ 1 & 0 \end{psmallmatrix}$.
\end{prop}

\begin{proof}
    Recall Noether's formula, which says that
    \[ \chi(\mc{O}_M) = \frac{{c_1(M)}^2 + c_2(M)}{12}. \]
    In the case of a K3 surface, we know $\chi(\mc{O}_M) = 2$, so we get $c_2(S) = 24$. Because $c_2(S)$ is also the Euler class, we see that $\chi_{\mr{top}}(S) = 24$, which gives us $b_2 = 22$ and $h^{1,1} = 20$. The computation of $H^2(S, \Z)$ as a \textbf{lattice} follows from the abstract classification of lattices once we know that $H^2(S, \Z)$ is unimodular and even of indefinite signature. Recall that a lattice $\Lambda$ is called even if for all $\alpha \in \Lambda$, $\alpha^2 \in 2\Z$ and unimodular if the matrix corresponding to the bilinar form has determinant $\pm 1$.\footnote{For other hyperk\"ahler manifolds, the lattice is not unimodular.}

    To prove that $H^2(S, \Z)$ is even, we use Wu's formula, which says that for all $\alpha \in H^2(M, \Z)$ (for any compact complex surface $M$) we have $c_1 \cdot \alpha \equiv \alpha^2 \pmod 2$. For a K3 surface, this clearly implies that $H^2(S, \Z)$ is even.
\end{proof}

We now consider Hirzebruch-Riemann-Roch on a K3 surface. If $L$ is a line bundle and $X$ is a surface, we have
\[ \chi(X, L) = \frac{L^2 - L \cdot K_X}{2} + \chi(\mc{O}_X). \]
For a K3 surface, we have $\chi(S, L) = \frac{L^2}{2} + 2$.

\begin{cor}\leavevmode
    \begin{itemize}
        \item If $L^2 \geq -2$, then $\pm L$ is effective.
        \item If $L^2 \geq 0$, then either $L = \mc{O}_S$ or $h^0(\pm L) \geq 2$.
        \item If $L = \mc{O}_S(C)$ for an irreducible curve $C$, then $L^2 = 2g-2$.
    \end{itemize}
\end{cor}

\begin{exm}
    If $C = R$ is a smooth rational curve, then $R^2 = -2$. If $C = E$ is an elliptic curve, then $E^2 = 0$.
\end{exm}

Now for a compact complex manifold, define the \textit{Neron-Severi group} $\mr{NS}(X) = \Pic X / \Pic^0 X$. This emerges from the exponential sequence
\[ 0 \to \Z \to \mc{O}_X \to \mc{O}_X^* \to 1 \]
as the image of $\Pic X \xrightarrow{c_1} H^2(X, \Z)$. By the Lefschetz theorem on $(1,1)$-classes, we know $\Im c_1 = H^2(X, \Z) \cap H^{1,1}_{\R}$. In particular, if $X$ is irreducible holomorphic symplectic, $H^1(\mc{O}_X) = 0$, so $\mr{NS} = \Pic$. The reason we care about this is that if we consider $\mr{Def}(X) \to \Omega$ and identify $H^2(X, \R) = H^2(X_t, \R)$, then the rank $\rho(X) = \rk \Pic X$ can vary.

We now return to consider consequences of the local Torelli theorem.
\begin{prop}
    Let $X$ be irreducible holomorphic symplectic. Then some small deformation of $X$ is projective.
\end{prop}

\begin{proof}
    It suffices to show that there exists a small deformation such that $X_t$ contains a K\"ahler class that is rational. By the Kodaira embedding theorem, such a class is the first Chern class of an ample line bundle. To prove this, recall the identification $\Omega \cong \mr{Gr}^+(2, H^2(X, \R))$. But then the set of planes $W \subseteq H^2(X, \R)$ defined over $\Q$ are dense, so for $0 \in \mr{Def}(X)$ and corresponding $\wp(0) \in \Omega$, we can choose a nearby point such that $W$ is defined over $\Q$. But then $W^{\perp} = H^{1,1}$ is also defined over $\Q$. Thus if $t \in \mr{Def}(X)$ satisfies $\wp(t) = W$, then $H^{1,1}(X_t)$ is also defined over $\Q$. In particular, $H^{1,1}_{\R} \cap H^2(X_t, \Q)$ is dense and has maximal rank. But then it must have nonempty intersection with the K\"ahler cone of $X_t$, so we are done.
\end{proof}

Now let $X$ be irreducible holomorphic symplectic, $L$ be a line bundle, and $\ell = c_1(L) \in H^2(X, \Z)$. Set $\Omega_{\ell} \coloneqq \Omega \cap \ell^{\perp}$ and ${\mr{Def}(X)}_{\ell} = \wp^{-1} (\Omega_{\ell}) \subseteq \mr{Def}(X)$. Then if $\mc{X} \to \mr{Def}(X)$ is the universal deformation, we will call $\mc{X}_{\ell}$ the base change to ${\mr{Def}(X)}_{\ell}$.

\begin{prop}
    The space $\mr{Def}(X)_{\ell} \subset \mr{Def}(X)$ is a smooth hypersurface and is the univeral deformation space of $\mr{Def}_{(X, L)}$ (which means there exists a universal line bundle $\mc{L}$ on $\mc{X}_{\ell}$ such that $\mc{L} |_{X_0} = L$, $\mc{L} |_{X_t} = L_t$, and $c_1(L_t) = \ell_t$). More generally, if $L_1, \ldots, L_k \in \Pic X$ have $\ell_1, \ldots, \ell_k$ linearly independent, then $\mr{Def}(X, L_1, \ldots, L_k) \subseteq \mr{Def}(X) = \wp^{-1}(\Omega \cap \ev{\ell_i}^{\perp})$ is smooth of codimension $k$.
\end{prop}

\begin{proof}
    Note that $\ell^{\perp} \subseteq \P H^2(X, \C)$ is smooth if and only if $q(\ell) \neq 0$. On the other hand, if $q(\ell) = 0$, the only singular point is $\ell \in \ell^{\perp}$, but then such an $\ell$ cannot lie in $\Omega$. Thus a necessary condition for $X_t$ to have a line bundle $L_t$ with $c_1(L_t) = \ell_t$ is that $\ell_t$ is a $(1,1)$-class, which is equivalent to $q(\ell_t, \sigma_t) = 0$. Of course, this is equivalent to $\wp(t) \in \Omega_{\ell}$. In particular, we know that if $(\mc{X}, \mc{L}) \to B$ is a deformation of $(X, L)$, the Kodaira-Spencer map $B \to \mr{Def}(X)$ must factor through ${\mr{Def}(X)}_{\ell}$. Of course, by the Lefschetz $(1,1)$-theorem, this is also a sufficient condition. In particular, for all $t \in \mr{Def}(X)_{\ell}$, we have $q(\sigma_t, \ell_t) = 0$, so $\ell_t \in H^{1,1} \cap H^2(X, \Z)$, so there exists a unique line bundle $L_t$ such that $c_1(L_t) = \ell_t$. Therefore on $X_{\ell} \to \mr{Def}(X)_{\ell}$, every fiber has a line bundle, so we prove that there exists a global line bundle and that such a line bundle is universal.

    We show that $\mr{Def}(X, L)$ is unobstructed with tangent space $\ker [H^1(T_X) \xrightarrow{c(L)} H^2(X, \mc{O}_X)] \subseteq H^1(T_X)$. This is induced by the perfect pairing
    \[ H^1(T_X) \otimes H^1(\Omega^1_X) \to H^2(\mc{O}_X) = \C. \]
    Consider $\mc{O}_X \xrightarrow{\dd} \Omega^1_X$ and the corresponding map $\mc{O}_X^* \to \Omega^1_X$ given by $u \mapsto \frac{\dd u}{u}$. This induces a map
    \[ H^1(X, \mc{O}_X) \xrightarrow{c(-)} H^1(X, \Omega_X) = \Ext^1(T_X, \mc{O}_X). \]
    Thus we have $L \mapsto c(L) \in [0 \to \mc{O}_X \to \mc{E}_L \to T_X \to 0]$. This gives us an exact sequence
    \[ 0 = H^1(X, \mc{O}_X) \to H^1(X, \mc{E}_L) \hookrightarrow H^1(X, T_X) \twoheadrightarrow H^2(X, \mc{O}_X) \to H^2(X, \mc{E}_L) \to H^2(X, T_X). \]
    We also have $H^1(X, \mc{E}_L) = T_{\mr{Def}(X, L)}$ and of course $H^1(X, T_X) = T_{\mr{Def}(X)}$. In addition, we have $H^2(X, \mc{E}_L) = \mr{Obs}(\mr{Def}_{(X,L)})$, but deformations of $X$ are unobstructed, so $\mr{Obs}(X, \mc{E}_L) = 0$, and thus deformations of $(X, L)$ are unobstructed.
\end{proof}

\section{Noether-Lefschetz loci}%
\label{sec:noether_lefschetz_loci}

\begin{defn}
    Let $f \colon \mc{X} \to B$ be a non-isotrivial family of irreducible holomorphic symplectic varieties over a connected $B$.\footnote{Note this is equivalent to the Kodaira-Spencer map being nontrivial.} Define
    \[ \rho_0 = \min_{t \in B} \qty{\rho(X_t)}. \]
    Then the \textit{Noether-Lefschetz locus}\footnote{Note this is a union of Hodge loci.} of $f$ is
    \[ \mr{NL}(f) = \qty{t \mid \rho(X_t) > \rho_0}. \]
\end{defn}

\begin{prop}[Green]
    The Noether-Lefschetz locus $\mr{NL}(f) \subseteq B$ is dense in the analytic topology.
\end{prop}

In fact, we will prove a stronger statement.

\begin{prop}[Oguiso]
    Suppose that $B$ is small enough such that there is an identification $\eta_t \colon H^2(X_t, \Z) \simeq H^2(X_0, \Z) \eqqcolon \Lambda$. In this case, there exists a period mapping $\wp \colon B \to \P \Lambda_{\C}$. Then there exists a primitive sublattice $\Lambda_0 \subseteq \Lambda$ of rank $\rho_0$ such that for all $t \in B$, $\NS(X_t) \supseteq \Lambda_0$.\footnote{Giulia did not give us a precise reference for this, but she said that there are two papers with the keywords `Picard rank' and `hyperk\"ahler' and that we would be able to figure out which one it is.}
\end{prop}

\begin{proof}
    Let $I$ be the set of all possible primitive sublattices $\Lambda_{\alpha} \subseteq \Lambda$. Then for all $\alpha \in I$, define $B_{\alpha} = \qty{t \in B \mid \NS(X_t) = \Lambda_{\alpha}}$. But then we see that $B = \bigcup B_{\alpha}$ and that $\wp(B_{\alpha}) \subseteq \P {(\Lambda_{\alpha, \C})}^{\perp}$. But now we know that
    \[ B = \bigcup \wp^{-1} (\Lambda_{\alpha, \C}^{\perp}), \]
    and thus there exists $\alpha_0$ such that $B = \wp^{-1}(\Lambda_{\alpha_0, \C}^{\perp})$ and therefore $\Lambda_{\alpha_0} \subseteq \NS(X_t)$ for all $t$.
\end{proof}

\begin{proof}[Proof of Green]
    We will assume that $B = \Delta$ is a disk and that $\wp \colon \Delta \to \P \Lambda_{\C}$ is injective. Let $\mc{H}^2_{\C} = R^2 f_* \C \otimes_{\C} \mc{C}^{\infty}(\Delta) \simeq H^2(X_0, \C) \times \Delta$ (where the last identification is local). Here, we have a Hodge filtration $\mc{F}^{\bullet} \mc{H}^2_{\C}$, and we let $\mc{H}^2_{\R}$ be the real part of this bundle. If we intersect $\mc{F}^1 \mc{H}^2 \cap \mc{H}^2_{\R}$, we obtain precisely the bundle $\mc{H}^{1,1}_{\R}$.

    The key claim is that the natural map $\phi \colon \mc{H}^{1,1}_{\R} \to H^2(X_0, \R)$ is an open immersion. Assuming this, we know $H^2(X_0, \Q) \subseteq H^2(X, \R)$ is dense and $\Lambda_0 \subseteq H^2(X, \Q)$ has smaller rank, so $H^2(X_0, \Q) \setminus \Lambda_0$ is dense. In particular, $\phi^{-1}(H^2(X_0, \Q) \setminus \Lambda_0) \subseteq \mc{H}^{1,1}_{\R}$ is dense. In particular, for any $\alpha$, the set of $t$ for which $\alpha_t$ has type $(1,1)$ is dense.

    We omit the proof of the key claim because it uses the Gauss-Manin connection. The idea is that the differential of $\phi_{\C} \colon \mc{H}^2_{\C} \to H^2(X_0, \C)$ is surjective. This is done by identifying it in terms of the Gauss-Manin connection and the differential of the period map.
\end{proof}

\begin{defn}
    A pair $(X, H)$ of a complex manifold $X$ and line bundle $H$ is called a \textit{polarized complex manifold} if $H$ is ample (in particular this means $X$ is projective). Here, $H$ is called the polarization. A polarized family $(\mc{X}, \mc{H})$ over $B$ has $\mc{H}$ ample on every fiber.
\end{defn}

\begin{defn}
    A family $\mc{X} \to B$ of irreducible holomorphic symplectic manifolds is \textit{(locally) complete} if $B = \mr{Def}(X_0)_h$.
\end{defn}

\begin{exm}
    The family of quartic K3 surfaces is locally complete.
\end{exm}

For higher-dimensional irreducible holomorphic symplectic manifolds, it is in general very hard to construct such locally complete families. The known such constructions are EPW sextics, which are IHS fourfolds of $K3^{[n]}$ type, fourfolds constructed by Debarre-Voisin, and various examples constructed from cubic fourfolds.

\begin{thm}[Matsushita]
    Let $X$ be irreducible holomorphic symplectic of dimension $2n$ and $f \colon X \to B$ be surjective and proper with connected fibers and $0 < \dim B < 2n$ for $B$ a K\"ahler manifold (alternatively it can be a projective variety). Then $\dim B = n$, $B$ is projective, $b_2(B) = \rho(B) = 1$, and $B$ is Fano (alternatively $B$ is $\Q$-factorial and Fano with log-terminal singularities). Moreover, the general fiber is a complex torus and every component of a fiber is a Lagrangian subvariety.
\end{thm}

\begin{defn}
    Let $X$ be holomorphic symplectic. Then a subvariety $V$ is called \textit{Lagrangian} if $\dim V = \frac{1}{2} \dim X$ and for all resolutions $\nu \colon \wt{V} \to V \subseteq X$, $\nu^* \sigma_X = 0$.
\end{defn}

\begin{proof}
    Recall that if $g \colon Y \to Z$ is a surjective morphism of K\"ahler manifolds, then $g^* \colon H^k(Z, \Q) \to H^k(Y, \Q)$ is injective.\footnote{In general this is not true over $\Z$.} This immediately gives $H^{2,0}(B) = 0$, and thus $H^{1,1}(B) = H^2(B)$, which immediately gives a rational K\"ahler class, so $B$ is projective. Let $H$ be a polarization on $B$. If $m = \dim B$, then ${c_1(H)}^m \neq 0$ but ${c_1(H)}^{m+1} = 0$, and because $m < 2n$, we know ${c_1(H)}^{2n} = 0$, and by Fujiki, we have $q(f^* H) = 0$.

    Now let $\omega$ be a K\"ahler form on $X$. Because ${(f^*H)}^m = [X_b]$, if we write $L = f^* H$, then $L^m \wedge \omega_X^{2n-m} \neq 0$. Similarly, for $k \leq m$, $L^k \wedge \omega_X^{2n-k} \neq 0$ because $L^k = f^{-1}(H_1 \cap \cdots \cap H_k)$. We need to prove that $m = n$. Here, we apply Fujiki to $\omega + t L$. This gives us 
    \[ {(\omega + tL)}^{2n} = c {q(\omega + tL)}^n = c {[q(\omega) + t q(\omega, L)]}^n. \]
    If we expand this, we obtain
    \[ \omega^{2n} + \cdots + t^m \omega^{2n-m} L^m = c [{q(\omega)}^n + \cdots + t^n {q(\omega, L)}^n]. \]
    Comparing coefficients in $t$, we observe that the coefficient of $t^n$ is nonzero, and thus $n = m$.

    Now we prove that if $X_b$ is smooth, then it is Lagrangian. Using the Hodge-Riemann bilinear relations, this is the same as showing that
    \[ \int_{X_b} \sigma |_{X_b} \wedge \ol{\sigma} |_{X_b} \wedge \omega_{X}^{n-2} = 0. \]
    If $\omega$ is the restriction of a K\"ahler form on $X$, then our integral simply becomes
    \[ \int_X \sigma \wedge \ol{\sigma} \wedge \omega^{n-2} \wedge L^n. \]
    Applying Fujiki to $\sigma + \ol{\sigma} + t \omega + s L$ and using the fact that $q(\sigma, L) = q(\ol{\sigma}, L) = 0$, we obtain the desired conclusion. To conclude that all fibers are Lagrangian, we use a major result of Koll\'ar, which says that if $h \colon Y \to Z$ is a proper and surjective morphism of smooth projective varieties, then $R^i h_* \omega_Y$ is torsion free for all $i$. In particular, for $f \colon X \to B$, we see that $R^i f_* \mc{O}_X$ is torsion-free, so for $\ol{\sigma} \in H^2(\mc{O}_X)$, this maps to a torsion section $\ol{\sigma} \in H^0(B, R^2 f_* \mc{O}_X)$, which must vanish. Pulling back to $H^2(\wt{X_b}, \mc{O})$, $X_b$ is Lagrangian. By linear algebra reasons, $\dim X_b \leq n$, so $f$ is equidimensional.

    Next we prove that $B$ is Fano. First, it is clear that $H^1(\mc{O}_B) = 0$, so $\Pic B = \NS B$. But then $f^* \colon H^2(B) \subseteq H^{1,1}(X)$. For all $\alpha \in H^2(B)$, $q(f^* \alpha) = 0$, but because $H^{1,1}(X)$ has signature $(1, -)$, we see that $\dim H^2(B) = 1$. Thus $\NS(B) = \Z H$ for some $H$. This implies that $K_B = m H$, and we want to show that $m < 0$. If we consider the inclusion $f^* \Omega^1_B \hookrightarrow \Omega^1_X$, $\Omega^1_X$ is a slope-semistable bundle because $c_1(X) = 0$. In particular, $\mu(\Omega^1_{B}) \leq \mu(\Omega^1_X) = 0$, so $m \leq 0$. To prove that $m \neq 0$, we see that if $m \neq 0$, then $\mc{O}_B = f^* K_B \hookrightarrow \Omega^n_X$, so $H^0(\mc{O}_B) \subseteq H^0(\Omega^n_X)$, and for type reasons, this is impossible.
\end{proof}

\begin{rmk}
    A similar argument shows that if $\alpha \in H^2(X, \Z)$ satisfies $q(\alpha) = 0$, then $\alpha^n \neq 0$ but $\alpha^{n+1} = 0$.
\end{rmk}

There is a result of Verbitsky that the kernel of $q \colon S^2 H^2(X, \Z) \to H^*(X, \Q)$ is given by $\ev{\alpha^{n+1} \mid q(\alpha) = 0}$. Also, when we proved that $B$ is Fano, we used the following result.

\begin{prop}[Beauville]
    Let $X$ be irreducible holomorphic symplectic of dimension $2n$. then $H^0(\Omega^*_X) = \ev{\sigma_X}$, where $\sigma_X$ is the holomorphic form.
\end{prop}

\begin{proof}[Idea of proof]
    We consider the holonomy representation. We know that $\mr{Hol}(g) = \mr{Sp}(n)$, where $g$ is the hyperk\"ahler metric. This has an action on $\Omega^k_{X, x_0}$. By compactness of $X$, holomorphic tensors are parallel. Coversely, parallel forms are holomorphic. But then we consider representations of $\mr{Sp}(n)$ on $\bigwedge^k \C^{2n}$, but then by the representation-theoretic black box there exists a unique invariant if $k$ is even and no invariants if $k$ is odd.
\end{proof}

\begin{rmk}
    There exists a singular definition of irreducible holomorphic symplectic varieties. This uses the algebra of reflexive holomorphic forms.
\end{rmk}

Now we want to see that the smooth fibers of a Lagrangian fibration $X \to B$ are complex tori. But it is clear that $N_{X_b/X} = \mc{O}_{X_b}^n$ and that $N_{X_b/X} = \Omega^1_{X_b}$. Then we need to prove that $a \colon X \to \mr{Alb}(X)$ is an isomorphism, but we consider the sequence
\[ T \to X \to \mr{Alb}(X), \]
and the map $T \to X$ is \'etale, the map $T \to \mr{Alb}(X)$ is surjective, and finally by considering the effect of $a$ on $H_1$, this is an isomorphism.

Alternatively, we may use the holomorphic version of Arnold-Liouville. This describes smooth compact fibers of a completely integrable system. If $M$ is holomorphic symplectic and $h = (h_1, \ldots, h_n) \colon M \to \C^n$ has compact connected fibers and $\dd{h_1}, \ldots, \dd{h_n}$ linearly independent at every point, $h$ is an integrable system if they Poisson commute. This all implies that the smooth fibers are biholomorphic to complex tori. In our case, each vector field $X_{h_i}$ defined by $\dd{h_i} = \sigma_M(X_{h_i}, -)$ acts infinitesimally on $M$ and preserves the level set of $h_{j}$ for all $j$. Thus $X_{h_i}$ acts on each fiber. Because the fibers are compact, the action lifts to an action of $\C$ on the fibers $M_c$. Of course, all of these actions commute, and we obtain an action of $\C^n$ on each $M_c$. The orbits are open, and the fibers are connected, so there exists a unique orbit and the action is transitive. However, the kernel is discrete and has maximal rank, and thus we obtain $M_c = \C^n / \Lambda$.

In our case, the fact that $[X_{h_i}, X_{h_j}] = 0$ is the same thing as our fibers being Lagrangian, and then we can just work locally.

\section{An explicit computation}%
\label{sec:an_explicit_computation}

We will compute the Beauville-Bogomolov-Fujiki form for irreducible holomorphic symplectic varieties $X$ of $\mr{K3}^{[n]}$ type.

\begin{prop}
    There exists an isomorphism of lattices
    \[ (H^2(X, \Z), q) \cong \Lambda_{\mr{K3}} \oplus \ev{-2(n-1)}. \]
    Moreover, the Fujiki constant is given by 
    \[ c_n \coloneqq \frac{(2n)!}{n!2^n}. \]
\end{prop}

\begin{proof}
    By deformation invariance, it is enough to perform this computation for $X = S^{[n]}$, where $S$ is a K3 surface. Recall that
    \[ H^2(S^{[n]}, \Z) = h^*(H^2(S^{(n)}, \Z)) \oplus \Z \delta \]
    where $h$ is the Hilbert-Chow morphism and we have the isomorphism $H^2(S^{(n)}, \Z) \simeq H^2(S, \Z)$. Also, if $E$ is the exceptional divisor of $h$, then $2 \delta = c_1(E)$. Our strategy is the following:
    \begin{enumerate}
        \item We will prove that $q |_{H^2(S, \Z)} = (-,-)_S$ up to a constant.
        \item We will prove that $\delta \perp H^2(S, \Z)$.
        \item We will compute $q(\delta)$.
        \item We will compute the Fujiki constant.
    \end{enumerate}
    Let $\alpha \in H^2(S, \Z)$. We will compute
    \begin{align*}
        \int_{S^{[n]}} h^* \qty(\sum p_i^* \alpha)^{2n} &= \int_{S^{(n)}} \qty(\sum p_i^* \alpha)^{2n} \\
        &= \frac{1}{n!} \int_{S^n} \qty(\sum p_i^* \alpha)^{2n}. \\
        &= \frac{1}{n!} \int_{S^n} (p_1^* \alpha + \cdots + p_n^* \alpha)^{2n} \\
        &= \frac{1}{n!}\sum \binom{2n}{k_1} \binom{2n-k_1}{k_2} \cdots p_1^* \alpha^{k_1} \cdots p_n^* \alpha^{k_n} \\
        &= \frac{1}{n!} \binom{2n}{2} \binom{2n-2}{2} \cdots \binom{4}{2} \prod_{i=1}^n p_i^*(\alpha \wedge \alpha) \\
        &= \frac{(2n)!}{n!2^n} (\alpha, \alpha)_S^n.
    \end{align*}
    Continuing, we have
    \begin{align*}
        \int_S^{[n]} h^* (\alpha)^{2n-1} \cdot E &= c \cdot q(\alpha)^{n-1} q(\alpha, E) \\
        &= \int_E h^*(i(\alpha))^{2n-1} = 0
    \end{align*}
    because $h(E) = \Delta^{2n-2}$, and so the integral vanishes by dimension reasons. Now we have
    \[ q(\alpha) = \lambda (\alpha, \alpha)_S \]
    for some $\lambda \in \Z$, and because $\int \alpha^{2n} = c_n q(\alpha)^n = c_X (\alpha, \alpha)^n$, we have $c_X = c_n \cdot \lambda^n$. Later, we prove that $\lambda = 1$. To compute $q(\delta)$, we compute
    \begin{align*}
        \int_{S^{[n]}} E^2 \wedge h^* \qty(\sum p_i^* \alpha)^{2n-2} &= \int_E E|_E \wedge h^* \alpha^{2n-2} \\
        &= \int_{\Delta} h_* (E|_E) \wedge \qty(\sum p_i^* \alpha)^{2n-2},
        &= -2 \int_{\Delta} \qty(\sum p_i^* \alpha)^{2n-2}.
    \end{align*}
    Note that $h_* (E|_E) = -2$ because $E \to \Delta$ looks locally like the resolution of a quadric cone. Noting that we have a diagram
    \begin{equation*}
    \begin{tikzcd}
        E \ar{r} & \Delta \\
        S \times S^{n-2} \ar{ur}{\eta} \ar{r}{(n-2)!} & S \times S^{(n-2)} \ar{u}{\mr{bir.}},
    \end{tikzcd}
    \end{equation*}
    our integral becomes
    \begin{align*}
        \frac{-2}{(n-2)!} \int_{S^{n-1}} \eta^* \qty(\sum p_i^* \alpha)^{2n-2} &= \frac{-2}{(n-2)!} \qty(\frac{(2n-2)!}{2^{n-1}} 2^2 (\alpha, \alpha)_S^{n-1}).
    \end{align*}
    On the other hand, we can differentiate the Fujiki relation twice, and we know that
    \begin{align*}
        (2n-1) \int_{S^{[n]}} E^2 \wedge h^* \alpha^{2n-2} &= c_X q(\alpha)^{n-1} q(E) \\
        &= c_X \lambda^{n-1} (\alpha, \alpha)_S^{n-1} q(E). \\
        &= \frac{c_n}{\lambda} (\alpha, \alpha)_S^{n-1} q(E).
    \end{align*}
    Comparing the coefficients, we obtain 
    \[ \frac{-(2n-1)!}{(n-2)! 2^{n-4}} = \frac{4}{\lambda} \frac{(2n)!}{n!2^n} q(\delta), \]
    and after cancelling everything, we have
    \[ \frac{-2}{(n-2)!} = \frac{1}{\lambda} \frac{1}{n-1} q(\delta), \]
    and therefore $q(\delta) = -2(n-1)\lambda$.\footnote{This was exhibit $N \gg 0$ that mathematicians are bad at arithmetic.} Finally, we are forced to take $\lambda = n-1$, so we are done.
\end{proof}

In the case when $n=2$, there is a more explicit argument using intersection theory and Segre classes of the Hilbert scheme of $2$ points.

\begin{rmk}
    It is not a coincidence that $q(E) < 0$.
\end{rmk}

\begin{defn}
    If $X$ is irreducible holomorphic symplectic, then $E \subseteq X$ is called \textit{prime exceptional} if it is integral and $q(E) < \infty$.
\end{defn}

\begin{thm}[Markman,\footnote{Fun fact: Markman was on my undergraduate thesis committee.} Druel]
    $E \subseteq X$ is prime exceptional if and only if there exists a birational $f \colon X \dashrightarrow X'$ such that the strict transform $E'$ of $E$ can be contracted.
\end{thm}

\begin{prop}
    Let $f \colon x \dashrightarrow X'$ be a birational map between irreducible holomorphic symplectic varieties. Then the isomorphism
    \[ f^* \simeq H^2(X', \Z) \simeq H^2(X, \Z) \]
    preserves $q_{X'}$ and $q_X$.
\end{prop}

\begin{proof}
    If we consider the graph $\wt{\Gamma}$ of $f$ with projections $p, q$, we can normalize first so that 
    \[ \int_X (\sigma \ol{\sigma})^n = 1, \]
    and then we compute
    \[ \int_{\Gamma} p^*(\sigma \ol{\sigma})^{n-1} E^2 = 0. \]
\end{proof}

Recall that if $Z$ is a smooth projective variety and $\mc{F}$ is a coherent sheaf, then
\[ \chi(Z, \mc{F}) = \int_Z \mr{ch}(\mc{F}) \mr{td}(Z) \]
by Hirzebruch-Riemann-Roch. If $\mc{F} = L$ is a line bundle, then we have
\[ \chi(Z, L) = \sum \int_Z \frac{c_1(L)^i}{i!} \mr{td}_{\dim Z - i}(Z). \]

\begin{prop}
    Let $X$ be irreducible holomorphic symplectic. Then there exist $q_i \in \Q$ depending only on the deformation class of $X$ such that
    \[ \chi(X, L) = \sum_{i=0}^n q_i q(L)^i. \]
\end{prop}

\begin{cor}
    For all isotropic $L$, we have $\chi(X, L) = n+1$, where $X$ has dimension $2n$.
\end{cor}

To prove the proposition, we need to prove the following Fujiki-like result.
\begin{prop}
    Let $\beta \in H^{4\ell}(X, \R)$ be a class that stays of type $(2\ell, 2\ell)$ for all small deformations of $X$. Then there exists $c_{\beta} \in \R$ such that $\int \beta \wedge \alpha^{2n-2\ell} = c_{\beta} q(\alpha)^{n-\ell}$ for all $\alpha \in H^2(X, \Z)$.
\end{prop}
Proof of this is the same as the proof of Fujiki.



\end{document}
